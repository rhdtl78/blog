<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Jeonghun Kong's Devlog Blog</title>
        <link>https://rhdtl78.github.io/</link>
        <description>Jeonghun Kong's Devlog Blog</description>
        <lastBuildDate>Sun, 24 Sep 2023 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Ehcache와 RMI를 활용한 다중 서버 환경의 캐싱 문제 해결]]></title>
            <link>https://rhdtl78.github.io/dev-blog/programming/distributed-ehcache</link>
            <guid>https://rhdtl78.github.io/dev-blog/programming/distributed-ehcache</guid>
            <pubDate>Sun, 24 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[분산 환경에서의 Ehcache 설정과 RMI 기반 클러스터링 구현]]></description>
            <content:encoded><![CDATA[<p>현재 프로젝트에서의 다중 서버 환경에서 발생한 embedded 캐싱 문제와 해결 방법에 대해 설명한다.</p><h1>문제 상황</h1><p>현재 맞고있는 프로젝트에서 사용중인 서버는 총 20대의 WAS 인스턴스와 각 2대씩을 연결하는 Apache 웹 서버로 구성되어있다. 물리 서버는 총 10대로 각각 2대의 인스턴스를 구동하고있다. 모든 서버는 온프레미스 환경이다. 업무상 연동하고있는 외부 서비스중 하나가 oauth2.0 기반 인증 절차를 사용한다.  해당 서비스에서 발급된 <code>authorize_code</code> 는 일회용이며, 이 코드를 통해 <code>access token</code>을 발급받을 수 있다. 프로젝트에서 제공하는 기능중에는 <code>authorize_code</code> 만을 가지고 <code>access token</code> 을 발급 받아  캐싱하여 만료될때까지 사용한다. 서버는 <code>authorize code</code> 를 key로 캐시를 구성하며 이후의 <code>access token</code> 발급 요청에 대비한다. 그러나 다중 인스턴스로 인해 캐시를 구성한 인스턴스가 아닌 다른 모든 인스턴스는 <code>access token</code> 발급에 실패한다.</p><h1>계획</h1><p>현재 Ehcache를 모든 이벤트 서버 WAS 인스턴스에서 embed 하여 사용중이다. Ehcache는 <a href="https://www.ehcache.org/documentation/2.8/replication/rmi-replicated-caching.html" target="_blank" rel="noopener noreferrer">클러스터링을 지원</a>한다. 로컬 캐시 설정을 분산 캐시 설정으로 변경하여 인스턴스간 캐시 불일치 문제를 해결할 수 있다.
단, 이번에 설정할 RMI 기반 클러스터링은 multicast 를 사용할 수 없다면, 수동으로 P2P 연결 설정을 진행해야 한다.
ehcache가 지원하는 분산 캐시 설정에는 4가지가 있다. (2.x 한정).</p><ol><li><p>Terracota
Terracota 라는 별도의 서비스를 구동하여 구성하는 방식이다. 서버 구조를 변경할 수 없는 상황이므로 제외되었다.</p></li><li><p>RMI (Remote Method Invocation)
본 글에서 설명하는 방식이다. 라우터나 스위치에서 지원하는 multicast ip 대역을 사용해 메시지를 주고받은 방식이다.</p></li><li><p>JGROUP
RMI 와 비슷한 방식이지만, 설정이 더 복잡하고 연구할 시간이 모자르기에 선택 대상에서 제외했다.</p></li><li><p>JMS
별도의 Message Queue를 사용하는 방식이다. 마찬가지로, 별도 서버를 구성할 수 없는 상황이기에 제외되었다.</p></li></ol><h1>도안</h1><p>아래는 목표 구성의 도안이다. IP 주소는 물리 서버의 구분을 나타내기 위해 표시한 가상의 IP 이다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="as-is">AS-IS<a href="#as-is" class="hash-link" aria-label="Direct link to AS-IS" title="Direct link to AS-IS">​</a></h2><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">----- 172.0.0.1 -----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        WEB        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---- 172.0.0.2,3 ----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  App  |  EhCache  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------  X 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       TOMCAT      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="to-be">TO-BE<a href="#to-be" class="hash-link" aria-label="Direct link to TO-BE" title="Direct link to TO-BE">​</a></h2><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">----- 172.0.0.1 -----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        WEB        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          |        RMI with multicast</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          |    ┌-----------------------┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----- 172.0.0.2 -----    ----- 172.0.0.3 -----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|  App  |  EhCache  |    |  App  |  EhCache  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------    ---------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       TOMCAT      |    |       TOMCAT      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------------    ---------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>구현</h1><p>Java Config 로 설정한 내용은 아래와 같다. 본 글과 비슷한 키워드로 검색하면 많이 보이는 내용과 차이가 크게 없다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="buildgradle">build.gradle<a href="#buildgradle" class="hash-link" aria-label="Direct link to build.gradle" title="Direct link to build.gradle">​</a></h3><div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dependencies {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    implementation 'net.sf.ehcache:ehcache:2.10.4'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-config">Java Config<a href="#java-config" class="hash-link" aria-label="Direct link to Java Config" title="Direct link to Java Config">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.InetAddress;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.UnknownHostException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.sf.ehcache.Cache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.sf.ehcache.config.CacheConfiguration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.sf.ehcache.config.CacheConfiguration.CacheEventListenerFactoryConfiguration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.sf.ehcache.config.DiskStoreConfiguration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.sf.ehcache.config.FactoryConfiguration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.sf.ehcache.config.PersistenceConfiguration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import net.sf.ehcache.config.PersistenceConfiguration.Strategy;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.Logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.LoggerFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.cache.CacheManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.cache.ehcache.EhCacheCacheManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Primary;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CacheConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger log = LoggerFactory.getLogger(CacheConfig.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Primary</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CacheManager cacheManager() throws UnknownHostException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        net.sf.ehcache.CacheManager cacheManager = createEhCacheManager();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cacheManager.addCache(applyRmiEventListener(cacheChannelOneMin()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new EhCacheCacheManager(cacheManager);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private net.sf.ehcache.CacheManager createEhCacheManager() throws UnknownHostException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        net.sf.ehcache.config.Configuration configuration = new net.sf.ehcache.config.Configuration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configuration.diskStore(new DiskStoreConfiguration().path("java.io.tmpdir"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String hostname = InetAddress.getLocalHost().getHostName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info("hostname: {}", hostname);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // multicast 설정</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FactoryConfiguration factoryConfig = new FactoryConfiguration()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .className("net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .properties("peerDiscovery=automatic,multicastGroupAddress=228.0.0.4,multicastGroupPort=4446,timeToLive=1")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .propertySeparator(",");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configuration.cacheManagerPeerProviderFactory(factoryConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 다른 노드에서 발생한 이벤트 리스너</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FactoryConfiguration listenerFactoryConfig = new FactoryConfiguration()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .className("net.sf.ehcache.distribution.RMICacheManagerPeerListenerFactory")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .properties("socketTimeoutMillis=2000,port=40000,hostName=" + hostname)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .propertySeparator(",");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configuration.cacheManagerPeerListenerFactory(listenerFactoryConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return net.sf.ehcache.CacheManager.create(configuration);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Cache applyRmiEventListener(Cache cache) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 캐시 별 변경 내역을 전송 설정</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CacheEventListenerFactoryConfiguration eventListenerFactoryConfig = new CacheEventListenerFactoryConfiguration()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .className("net.sf.ehcache.distribution.RMICacheReplicatorFactory")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 동기적으로 변경사항을 전파, 새로운 캐시 항목 전파, 캐시 항목의 변경사항 전파, 캐시 항목의 변경 사항을 evict 하는 것으로 대체.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .properties("replicateAsynchronously=false,replicatePuts=true,replicateUpdates=true,replicateUpdatesViaCopy=false,replicateRemovals=true")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .propertySeparator(",");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache.getCacheConfiguration()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .cacheEventListenerFactory(eventListenerFactoryConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return cache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Cache cacheChannelOneMin() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new Cache(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new CacheConfiguration()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name("cacheChannelOneMin")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .maxEntriesLocalHeap(1000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .eternal(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .persistence(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    new PersistenceConfiguration()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .strategy(Strategy.LOCALTEMPSWAP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .timeToIdleSeconds(60)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .timeToLiveSeconds(60)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .memoryStoreEvictionPolicy("LRU")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>RMICache</code> 로 보이는 내용들이 모두 RMI 기반 분산 캐시 설정에 관한 내용이다.  그러나 놀랍게도,</p><blockquote><p><strong><span style="font-size:2rem">위 설정은 제대로 동작하지 않는다.</span></strong></p></blockquote><p>적용할 프로젝트가 Spring MVC project (springframework 5.X) 라서 그런것 같아, Springboot 2.x 로 클린 프로젝트를 구성후 시도했음에도, 각 인스턴스가 서로를 찾지 못하는 모습을 보였다. PeerProvider가 동작하지 않는 것 처럼, PeerListener는 등록된 것이 보였는데, PeerListener 가 아무 동작도 하지 않았다.</p><p>이에 xml 기반 설정으로 옮긴 후에야 동작했다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ehcachexml"><code>ehcache.xml</code><a href="#ehcachexml" class="hash-link" aria-label="Direct link to ehcachexml" title="Direct link to ehcachexml">​</a></h3><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;ehcache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xsi:noNamespaceSchemaLocation="https://www.ehcache.org/ehcache.xsd"&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;diskStore path="java.io.tmpdir"/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;cacheManagerPeerProviderFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        class="net.sf.ehcache.distribution.RMICacheManagerPeerProviderFactory"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        properties="peerDiscovery=automatic,multicastGroupAddress=228.0.0.4,multicastGroupPort=4446,timeToLive=1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        propertySeparator=","</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;cacheManagerPeerListenerFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        class="net.sf.ehcache.distribution.RMICacheManagerPeerListenerFactory"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        properties="hostName=localhost, port=40001, socketTimeoutMillis=2000"/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;cache name="cacheChannelOneMin"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxEntriesLocalHeap="1000"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxEntriesLocalDisk="10000"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        diskPersistent="false"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timeToIdleSeconds="1000"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timeToLiveSeconds="1000"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        memoryStoreEvictionPolicy="LRU"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;cacheEventListenerFactory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            class="net.sf.ehcache.distribution.RMICacheReplicatorFactory"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            properties="replicateAsynchronously=false,replicatePuts=true,replicateUpdates=true,replicateUpdatesViaCopy=false,replicateRemovals=true"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            propertySeparator=","</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/cache&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/ehcache&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-config-1">Java Config<a href="#java-config-1" class="hash-link" aria-label="Direct link to Java Config" title="Direct link to Java Config">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.skp.ocb.cache.config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.cache.CacheManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.cache.ehcache.EhCacheCacheManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CacheConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CacheManager cacheManager() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        net.sf.ehcache.CacheManager cacheManager = new net.sf.ehcache.CacheManager();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new EhCacheCacheManager(cacheManager);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>버전 문제인가 싶어, ehcache 3.x 도 알아봤으나, 3버전 부터 패키지 이름부터가 달라졌으며, RMI 관련 구현이 모두 사라진 상태였다.</p><p>이후 더 이상 ehcache 로 할 수 있는 다른 분산 캐시 설정은 찾을 수 없었다. JGROUP은 multicast 기반이지만, 설정이 더 복잡해 관리 용이성을 위해 제외했고, JMS 는 별도의 MQ 서버가 필요해 선택 대상이 아니었다. terracota 역시 별도의 서비스가 필요함에 제외되었다.</p>]]></content:encoded>
            <category>Spring</category>
            <category>EHCache</category>
            <category>분산캐시</category>
        </item>
        <item>
            <title><![CDATA[Access Control with AOP]]></title>
            <link>https://rhdtl78.github.io/dev-blog/programming/acl-with-aop</link>
            <guid>https://rhdtl78.github.io/dev-blog/programming/acl-with-aop</guid>
            <pubDate>Sun, 03 Sep 2023 00:00:00 GMT</pubDate>
            <description><![CDATA[어노테이션 기반 접근 제어를 AOP로 구현해보자.]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="어노테이션-기반-접근-제어를-aop로-구현해보자">어노테이션 기반 접근 제어를 AOP로 구현해보자.<a href="#어노테이션-기반-접근-제어를-aop로-구현해보자" class="hash-link" aria-label="Direct link to 어노테이션 기반 접근 제어를 AOP로 구현해보자." title="Direct link to 어노테이션 기반 접근 제어를 AOP로 구현해보자.">​</a></h2><p>서버간 연동이 필요한 기능을 개발하다보면, 특정 <code>endpoint</code>들은 접근 IP가 제한되어야 할 필요가 생긴다.<br>
<!-- -->Spring Security 의 Filter chain을 활용하는 것이 일반적이겠지만, spring security 가 없는 프로젝트의 경우 많은 부분을 설정해줘야하는 불편이 있다.
이번 글에는 annotation을 활용해 간단하게 구현한, ip 기반 acl 에 대해 설명한다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accesscontrol">@AccessControl<a href="#accesscontrol" class="hash-link" aria-label="Direct link to @AccessControl" title="Direct link to @AccessControl">​</a></h2><p>접근 제어 설정 여부 및 세부 설정을 하는 <code>annotation</code>.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package io.github.rhdtl78.acl.annotation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.annotation.ElementType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.annotation.Retention;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.annotation.RetentionPolicy;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.lang.annotation.Target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Retention(RetentionPolicy.RUNTIME)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Target({ElementType.METHOD, ElementType.TYPE})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public @interface AccessControl {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String[] include() default {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String[] exclude() default {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>include</code> 에 선언된 목록으로 허용 설정을, <code>exclude</code>로 선언된 목록으로 차단 설정을 할 수 있다.
<code>class</code> 및 <code>method</code> 기반 설정을 지원한다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accesscontroladvice">AccessControlAdvice<a href="#accesscontroladvice" class="hash-link" aria-label="Direct link to AccessControlAdvice" title="Direct link to AccessControlAdvice">​</a></h2><p>접근 제어를 처리하는 세부 로직을 담당하는 클래스.
<code>loop back ip</code>와 <code>CIDR 표기법</code>을 지원한다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package io.github.rhdtl78.acl.advice;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.github.rhdtl78.acl.annotcation.AccessControl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.github.rhdtl78.acl.exception.AclDeniedException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Arrays;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import javax.servlet.http.HttpServletRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import javax.servlet.http.HttpServletResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.net.util.SubnetUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.aspectj.lang.JoinPoint;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.aspectj.lang.annotation.Aspect;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.aspectj.lang.annotation.Before;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.aspectj.lang.annotation.Pointcut;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.aspectj.lang.reflect.MethodSignature;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.context.request.RequestContextHolder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.context.request.ServletRequestAttributes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Aspect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AccessControlAdvice {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String CIDR_SUFFIX_PATTERN = "^([0-9]{1,3}\\.){3}[0-9]{1,3}(\\/([0-9]|[1-2][0-9]|3[0-2]))$";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String LOOPBACK_PATTERN = "^localhost$|^127(?:\\.[0-9]+){0,2}\\.[0-9]+$|^(?:0*\\:)*?:?0*1$";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Pointcut("@annotation(org.springframework.web.bind.annotation.RequestMapping) || @annotation(org.springframework.web.bind.annotation.GetMapping) || @annotation(org.springframework.web.bind.annotation.PostMapping) || @annotation(org.springframework.web.bind.annotation.PutMapping) || @annotation(org.springframework.web.bind.annotation.PatchMapping) || @annotation(org.springframework.web.bind.annotation.DeleteMapping)")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void endpoint() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Pointcut("@annotation(io.github.rhdtl78.acl.annotcation.AccessControl)")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void annotatedMethod() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Pointcut("@within(io.github.rhdtl78.acl.annotcation.AccessControl)")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void annotatedClass() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Before("execution(* *(..)) &amp;&amp; endpoint() &amp;&amp; (annotatedMethod() || annotatedClass())")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void checkAccessControl(JoinPoint joinPoint) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MethodSignature signature = (MethodSignature) joinPoint.getSignature();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AccessControl accessControl = signature.getMethod().getAnnotation(AccessControl.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (accessControl == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Class&lt;?&gt; declaringType = signature.getDeclaringType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            accessControl = declaringType.getDeclaredAnnotation(AccessControl.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.debug("accessControl: {}", accessControl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String remoteHost = request.getRemoteHost();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.debug("remoteHost: {}", remoteHost);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean isInAllowedHost = Arrays.stream(accessControl.include()).anyMatch(subnet -&gt; matches(remoteHost, subnet));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean isInDeniedHost = Arrays.stream(accessControl.exclude()).anyMatch(subnet -&gt; matches(remoteHost, subnet));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean isNotInAllowedPattern = accessControl.include().length &gt; 0 &amp;&amp; accessControl.exclude().length == 0 &amp;&amp; !isInAllowedHost;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean isInDeniedPattern = accessControl.include().length == 0 &amp;&amp; accessControl.exclude().length &gt; 0 &amp;&amp; isInDeniedHost;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean isMatchedWithDeniedPattern = accessControl.include().length &gt; 0 &amp;&amp; accessControl.exclude().length &gt; 0 &amp;&amp; (!isInAllowedHost || isInDeniedHost);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (isNotInAllowedPattern || isInDeniedPattern || isMatchedWithDeniedPattern) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new AclDeniedException("Access denied from ACL layer. please contact administrator");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean noConfiguration = accessControl.include().length == 0 &amp;&amp; accessControl.exclude().length == 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (noConfiguration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.debug("AccessControl annotation is empty. please check your code");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.debug("AccessControl is passed");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private boolean matches(String ip, String subnet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ip.matches(LOOPBACK_PATTERN)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (subnet.matches(CIDR_SUFFIX_PATTERN)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SubnetUtils utils = new SubnetUtils(subnet);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return utils.getInfo().isInRange(ip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ip.equals(subnet);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pattern">Pattern<a href="#pattern" class="hash-link" aria-label="Direct link to Pattern" title="Direct link to Pattern">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String CIDR_SUFFIX_PATTERN = "^([0-9]{1,3}\\.){3}[0-9]{1,3}(\\/([0-9]|[1-2][0-9]|3[0-2]))$";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String LOOPBACK_PATTERN = "^localhost$|^127(?:\\.[0-9]+){0,2}\\.[0-9]+$|^(?:0*\\:)*?:?0*1$";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>위 줄의 패턴 선언으로 <code>CIDR 표기법</code>, <code>loop back ip</code>를 감지할 수 있다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pointcut">pointcut<a href="#pointcut" class="hash-link" aria-label="Direct link to pointcut" title="Direct link to pointcut">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Pointcut("@annotation(org.springframework.web.bind.annotation.RequestMapping) || @annotation(org.springframework.web.bind.annotation.GetMapping) || @annotation(org.springframework.web.bind.annotation.PostMapping) || @annotation(org.springframework.web.bind.annotation.PutMapping) || @annotation(org.springframework.web.bind.annotation.PatchMapping) || @annotation(org.springframework.web.bind.annotation.DeleteMapping)")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void endpoint() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>컨트롤러에만 설정 할 수 있도록, 특히 <code>endpoint mapping</code> 에만 동작하도록 제한하는 Pointcut.<br>
<code>RequestMapping</code> 및 기타 <code>endpoint mapping</code> 을 모두 지원한다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Pointcut("@annotation(io.github.rhdtl78.acl.annotcation.AccessControl)")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void annotatedMethod() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Pointcut("@within(io.github.rhdtl78.acl.annotcation.AccessControl)")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void annotatedClass() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>메서드 기반 및 클래스 기반 설정을 지원하는 pointcut.<br>
<code>@Pointcut("@annotation(io.github.rhdtl78.acl.annotcation.AccessControl)")</code> 이 <code>@AccessControl</code>이 붙은 모든 메서드의 실행에 동작하게 하며,<br>
<code>@Pointcut("@within(io.github.rhdtl78.acl.annotcation.AccessControl)")</code> 이 <code>@AccessControl</code>이 붙은 클래스의 모든 메서드의 실행에 동작하게 한다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exception">exception<a href="#exception" class="hash-link" aria-label="Direct link to exception" title="Direct link to exception">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package io.github.rhdtl78.acl.exception;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AclDeniedException extends RuntimeException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AclDeniedException(String message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>접근 제어를 통과하지 못한 경우, 예외처리 할 수 있도록 발행하는 예외.<br>
<!-- -->기본적으로, 위 예외를 처리하는 <code>ControllerAdvice</code>도 준비되어있다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="controlleradvice">ControllerAdvice<a href="#controlleradvice" class="hash-link" aria-label="Direct link to ControllerAdvice" title="Direct link to ControllerAdvice">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package io.github.rhdtl78.acl.advice;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.github.rhdtl78.acl.exception.AclDeniedException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.annotation.Order;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.ExceptionHandler;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.RestControllerAdvice;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Order(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestControllerAdvice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AclRestControllerAdvice {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ExceptionHandler(AclDeniedException.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String handleAclDeniedException(AclDeniedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return e.getMessage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package io.github.rhdtl78.acl.advice;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.github.rhdtl78.acl.exception.AclDeniedException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.annotation.Order;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.ControllerAdvice;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.bind.annotation.ExceptionHandler;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.servlet.ModelAndView;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Order(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ControllerAdvice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AclControllerAdvice {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ExceptionHandler(AclDeniedException.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ModelAndView handleAclDeniedException(AclDeniedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ModelAndView modelAndView = new ModelAndView();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelAndView.setViewName("error");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelAndView.addObject("message", e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return modelAndView;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>@Controller</code>와 <code>@RestController</code>를 둘 다 지원하기 위해 각각의 ControllerAdvice를 만들었으나,<br>
<!-- -->ACL 예외를 던진 컨트롤러의 종류와 관계없이, <code>@Order(0)</code>으로 설정된 <code>AclRestControllerAdvice</code> 만 동작하더라.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="예시">예시<a href="#예시" class="hash-link" aria-label="Direct link to 예시" title="Direct link to 예시">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping("/")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AccessControl(include = ["10.0.0.1/32", "10.0.1.99"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MyController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String index() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return "index";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping("/")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MyController {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @AccessControl(include = ["10.0.0.1/32", "10.0.1.99"])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String index() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return "index";</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>Access Control</category>
            <category>Spring</category>
            <category>AOP</category>
            <category>AspectJ</category>
        </item>
        <item>
            <title><![CDATA[[오브젝트] Chapter09. 유연한 설계]]></title>
            <link>https://rhdtl78.github.io/dev-blog/object/chapter/09</link>
            <guid>https://rhdtl78.github.io/dev-blog/object/chapter/09</guid>
            <pubDate>Sat, 30 Jan 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[객체지향 프로그래밍]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="개방-폐쇄-원칙">개방-폐쇄 원칙<a href="#개방-폐쇄-원칙" class="hash-link" aria-label="Direct link to 개방-폐쇄 원칙" title="Direct link to 개방-폐쇄 원칙">​</a></h2><blockquote><p>소프트웨어 개체(클래스, 모듈, 함수 등등)은 확장에 대해 열려있어야 하고 수정에 대해서는 닫혀있어야 한다.<br>
<!-- -->-- 마틴 파울러.</p></blockquote><p>여기에는 <strong>'동작'</strong> 과 <strong>'코드'</strong> 의 관점을 반영한다, </p><ul><li>확장에 대해 열려있다.
애플리케이션의 요구사항이 변경될 때 이 변경에 맞게 새로운 <strong>'동작'</strong> 을 추가해서 애플리케이션의 기능을 확장할 수 있다.</li><li>수정에 대해 닫혀있다.
기존의 <strong>'코드'</strong> 를 수정하지 않고도 애플리케이션의 동작을 추가하거나 변경할 수 있다.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="컴파일-타임의-의존성을-고정시키고-런타임-의존성을-변경하라">컴파일 타임의 의존성을 고정시키고 런타임 의존성을 변경하라.<a href="#컴파일-타임의-의존성을-고정시키고-런타임-의존성을-변경하라" class="hash-link" aria-label="Direct link to 컴파일 타임의 의존성을 고정시키고 런타임 의존성을 변경하라." title="Direct link to 컴파일 타임의 의존성을 고정시키고 런타임 의존성을 변경하라.">​</a></h3><ul><li>런타임의 의존성은 실행시에 협력에 참여하는 객체들 사이의 관계이다. </li><li>컴파일 타임의 의존성은 코드에 드러나는 클래스들 사이의 관계이다.</li></ul><p>캡슐화 원칙을 지키는 객체는 꼭 필요한 퍼블릭 인터페이스만을 노출하기 때문에 인터페이스를 의존하는 객체들의 코드는 변경하지 않고<br>
<!-- -->인터페이스를 따르는 새로운 객체를 추가하는 것으로 기능을 확장할 수 있다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="추상화가-핵심이다">추상화가 핵심이다.<a href="#추상화가-핵심이다" class="hash-link" aria-label="Direct link to 추상화가 핵심이다." title="Direct link to 추상화가 핵심이다.">​</a></h3><p>개방-폐쇄 원칙의 핵심은 <strong>추상화에 의존하는 것이다.</strong> 추상화에 의해 생략되지 않고 남겨지는 부분은 다양한 상황에서의 공통점을 반영한 결과이기 때문에 문맥이 바뀌더라도 변하지 않아야 한다. (수정에 닫힘.)<br>
<!-- -->추상화에 생략된 부분은 확장의 여지를 남긴다. (확장에 열림.)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="생성-사용-분리">생성 사용 분리<a href="#생성-사용-분리" class="hash-link" aria-label="Direct link to 생성 사용 분리" title="Direct link to 생성 사용 분리">​</a></h2><blockquote><p>소프트웨어 시스템은 (응용 프로그램 객체를 제작하고 의존성을 서로 "연결"하는) 시작 단계와 (시작 단계에 이어지는) 실행 단계를 분리해야 한다.
-- 마틴 파울러</p></blockquote><p>생성과 사용이라는 두 가지 이질적인 동작이 하나의 객체안에서 공존하게 되어 캡슐화를 약화시킨다.<br>
<!-- -->이를 해결할 방법은 생성 책임을 객체 외부로 옮기는 것이다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="factory-추가하기">FACTORY 추가하기<a href="#factory-추가하기" class="hash-link" aria-label="Direct link to FACTORY 추가하기" title="Direct link to FACTORY 추가하기">​</a></h3><p>FACTORY에 해당 객체의 생성 책임을 옮기면 생성되는 인스턴스를 사용하는 다른 객체의 생성 책임이 사라지고 사용에 필요한 정보만 알고있으면 되기 때문에 캡슐화가 강화된다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="순수한-가공물에-책임-할당하기-pure-fabrication">순수한 가공물에 책임 할당하기 (PURE FABRICATION)<a href="#순수한-가공물에-책임-할당하기-pure-fabrication" class="hash-link" aria-label="Direct link to 순수한 가공물에 책임 할당하기 (PURE FABRICATION)" title="Direct link to 순수한 가공물에 책임 할당하기 (PURE FABRICATION)">​</a></h3><blockquote><p>시스템을 객체로 분해하는 데에는 크게 두 가지 방법이 존재한다.</p><ul><li>표현적 분해<br>도메인에 존재하는 사물 또는 객체들을 이용해 시스템을 분해하는 것이다.<br>객체지향 설계를 위한 가장 기본적인 접근법이다.</li><li>행위적 분해<br>도메인 개념을 표현하는 객체에게 책임을 할당하는 것만으로 부족한 경우에 사용하는 방법이다.
책임을 할당하기위해 도메인과 무관한 객체를 생성하는 방법이다.
책임으로 인한 결합도를 낮추고 응집도를 높일수 있게 된다. </li></ul></blockquote><p>PURE FABRICATION 은 표현적 분해보다는 행위적 분해에 의해 생성되는 것이 일반적이다.<br>
<!-- -->대부분의 디자인 패턴은 PURE FABRICATION 을 포함한다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="의존성-주입">의존성 주입<a href="#의존성-주입" class="hash-link" aria-label="Direct link to 의존성 주입" title="Direct link to 의존성 주입">​</a></h2><p>외부의 다른 객체가 협력에 참여하는 객체에게 의존하고있는 정보를 넘겨주는 것을 의존성 주입 (Dependency Injection)이라고 한다.<br>
<!-- -->의존성 주입에는 세 가지 방법이 있다. </p><ul><li>생성자 주입<br>객체를 생성하는 시점에 생성자를 통한 의존성 해결</li><li>setter 주입<br>객체 생성 후 setter 메서드를 통한 의존성 해결</li><li>메서드 주입(메서드 호출 주입)<br>메서드 실행 시 인자를 이용한 의존성 해결</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="숨겨진-의존성은-나쁘다">숨겨진 의존성은 나쁘다.<a href="#숨겨진-의존성은-나쁘다" class="hash-link" aria-label="Direct link to 숨겨진 의존성은 나쁘다." title="Direct link to 숨겨진 의존성은 나쁘다.">​</a></h3><p>SERVICE LOCATOR 패턴은 의존성 해결을 위한 제공자로서 활용된다. 깊은 계층의 객체에게 최단 경로로 의존성을 해결해 주지만, 의존성을 숨겨버리는 단점이 있다. </p><blockquote><p>SERVICE LOCATOR 패턴은 서비스를 사용하는 코드로부터 서비스가 누구인지(서비스를 구현한 구체 클래스의 타임이 무엇인지), 어디에 있는지(클래스 인스턴스를 어떻게 얻을 지)를 몰라도 되게 해준다.
-- Nystrom</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="의존성-역전-원칙">의존성 역전 원칙<a href="#의존성-역전-원칙" class="hash-link" aria-label="Direct link to 의존성 역전 원칙" title="Direct link to 의존성 역전 원칙">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="추상화와-의존성-역전">추상화와 의존성 역전<a href="#추상화와-의존성-역전" class="hash-link" aria-label="Direct link to 추상화와 의존성 역전" title="Direct link to 추상화와 의존성 역전">​</a></h3><p>의존성 역전 원칙(Dependency Inversion Principle)은 다음과 같은 두 가지 원칙을 갖는다. </p><ul><li>상위 수준의 모듈은 하위 수준의 모듈에 의존해서는 안된다. 둘 모두 추상화에 의존해야 한다. </li><li>추상화는 구체적인 상황에 의존해서는 안 된다. 구체적인 사항은 추상화에 의존해야 한다. </li></ul><p>상위 개념의 객체의 변경으로 인해 하위의 객체가 변경되는 것은 납득할 수 있지만, 하위 객체의 변경으로 인해 상위 객체가 변경되서는 안된다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="의존성-역전-원칙과-패키지">의존성 역전 원칙과 패키지<a href="#의존성-역전-원칙과-패키지" class="hash-link" aria-label="Direct link to 의존성 역전 원칙과 패키지" title="Direct link to 의존성 역전 원칙과 패키지">​</a></h3><p>서로 연관된 클래스를 같은 패키지 안에 두어야 한다. 서로 관련이 없는 클래스를 같은 패키지 안에 두는 것은 전체적인 빌드 시간을 가파르게 상승하게 한다.
이러한 기법을 SEPARATED INTERFACE 패턴이라고 부른다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="유연성에-대한-조언">유연성에 대한 조언<a href="#유연성에-대한-조언" class="hash-link" aria-label="Direct link to 유연성에 대한 조언" title="Direct link to 유연성에 대한 조언">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="유연한-설계는-유연성이-필요할-때만-옳다">유연한 설계는 유연성이 필요할 때만 옳다.<a href="#유연한-설계는-유연성이-필요할-때만-옳다" class="hash-link" aria-label="Direct link to 유연한 설계는 유연성이 필요할 때만 옳다." title="Direct link to 유연한 설계는 유연성이 필요할 때만 옳다.">​</a></h3><p>유연한 설계는 그 이면에 복잡한 설계란 의미를 내포하고있다. 불필요한 유연성은 불필요한 복잡성을 낳는다. 유지보수의 난이도는 자연스럽게 올라가고 소비되는 시간과 노력은 가파르게 상승한다.
설계는 언제나 트레이드오프의 산물임을 기억하자. 모든 설계에는 이유가 있어야 한다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="협력과-책임이-중요하다">협력과 책임이 중요하다.<a href="#협력과-책임이-중요하다" class="hash-link" aria-label="Direct link to 협력과 책임이 중요하다." title="Direct link to 협력과 책임이 중요하다.">​</a></h3><p>설계를 유연하게 만들기 위해서는 먼저 역할, 책임, 협력에 초점을 맞춰야 한다. 의존성을 관리해야 하는 이유는 역할, 책임, 협력의 관점에서 설계가 유연하고 재사용 가능해야 하기 때문이다.</p>]]></content:encoded>
            <category>Object</category>
            <category>Book Study</category>
            <category>OOP</category>
        </item>
        <item>
            <title><![CDATA[[오브젝트] Chapter07. 객체 분해]]></title>
            <link>https://rhdtl78.github.io/dev-blog/object/chapter/07</link>
            <guid>https://rhdtl78.github.io/dev-blog/object/chapter/07</guid>
            <pubDate>Mon, 25 Jan 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[객체지향 프로그래밍]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="개요">개요<a href="#개요" class="hash-link" aria-label="Direct link to 개요" title="Direct link to 개요">​</a></h2><p>사람이 수용할 수 있는 정보의 허용량을 넘어선 순간부터 문제 해결 능력은 급격하게 떨어지는 인지 과부하가 발생한다.<br>
<!-- -->인지 과부하를 방지하는 가장 좋은 방법은 쏟아지는 정보의 양을 조절하는 것이다. 추상화는 문제 해결에 필요한 핵심만 남기고 불필요한 정보를 제거하는 것을 말한다.</p><p>가장 일반적인 추상화 방법은 문제의 크기를 줄이는 것이다. 큰 문제를 해결 가능한 작은 문제로 나누는 것을 분해(decomposition)이라 한다.<br>
<!-- -->한번에 해결하기 어려운 문제를 생각하기 쉽도록 작은 문제로 다시 나누어 생각하면 접근하기 더 쉬워진다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="프로시저-추상화와-데이터-추상화">프로시저 추상화와 데이터 추상화<a href="#프로시저-추상화와-데이터-추상화" class="hash-link" aria-label="Direct link to 프로시저 추상화와 데이터 추상화" title="Direct link to 프로시저 추상화와 데이터 추상화">​</a></h2><ul><li><p>프로시저 추상화 (Procedure abstraction)
소프트웨어가 무엇을 해야 하는지를 추상화하는 방법이다. 기능 분해(functional decomposition)/알고리즘 분해(algorithm decomposition)를 통해 추상화할 수 있다.</p></li><li><p>데이터 추상화 (Data abstraction)
소프트웨어가 무엇을 알아야 하는지를 추상화는 방법이다. 데이터 추상화를 하는 방법에는 두 가지가 있다.</p><ul><li>타입을 추상화 (Type abstraction)</li><li>데이터를 중심으로 프로시저를 추상화</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="프로시저-추상화와-기능-분해">프로시저 추상화와 기능 분해<a href="#프로시저-추상화와-기능-분해" class="hash-link" aria-label="Direct link to 프로시저 추상화와 기능 분해" title="Direct link to 프로시저 추상화와 기능 분해">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="메인-함수로서의-시스템">메인 함수로서의 시스템<a href="#메인-함수로서의-시스템" class="hash-link" aria-label="Direct link to 메인 함수로서의 시스템" title="Direct link to 메인 함수로서의 시스템">​</a></h3><p>시스템을 구성하는 가장 최상위 기능을 정의하고, 이 최상위 기능을 좀더 작은 단계의 하위 기능으로 분해하는 방법을 하향식 접근법이라 한다.<br>
<!-- -->분해는 세분화된 마지막 하위 기능이 프로그래밍 언어로 구현 가능한 수준이 될 때 까지 계속된다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="하향식-기능-분해의-문제점">하향식 기능 분해의 문제점<a href="#하향식-기능-분해의-문제점" class="hash-link" aria-label="Direct link to 하향식 기능 분해의 문제점" title="Direct link to 하향식 기능 분해의 문제점">​</a></h3><ul><li>시스템은 하나의 메인 함수로 구성돼 있지 않다.</li><li>기능 추가나 요구사항 변경으로 인해 메인 함수를 빈번하게 수정해야 한다.</li><li>비즈니스 로직이 사용자 인터페이스와 강하게 결합된다.</li><li>하향식 분해는 너무 이른 시기에 함수들의 실행 순서를 고정시키기 때문에 유연성과 재사용성이 저하된다.</li><li>데이터 형식이 변경될 경우 파급효과를 예측할 수 없다.</li></ul><p>하나의 메인 함수라는 아이디어는 비현실적이다. 어떤 시스템도 최초에 릴리스됐던 당시의 모습을 그대로 유지하지는 않는다.<br>
<!-- -->계속해서 사용자의 요구를 만족하기 위해 새로운 기능을 추가하게 된다. 메인 함수는 결국 시스템 내의 다른 기능과 동등한 수준이 되어버린다.
하향식 접근법은 현대적인 상호작용 시스템을 개발하는 데는 적합하지 않다. 현대적인 시스템은 동등한 수준의 다양한 기능으로 구성된다.</p><p>또한 메인 함수의 빈번한 재설계를 유발하게 된다. 하향식 기능 분해의 경우 새로운 기능을 추가할 때 마다 메인 함수를 수정해야 한다.<br>
<!-- -->새로운 기능을 위한 적절한 위치를 확보하기 위해 메인 함수를 빈번히 건드려야 하기 때문이다.</p><p>하향식 접근법은 비즈니스 로직을 설계하는 초기 단계부터 입력 방법과 출력 양식을 함께 고민하도록 강요한다.<br>
<!-- -->코드 안에서 비즈니스 로직과 사용자 인터페이스가 밀접하게 결합되게 된다.</p><p>문제는 비즈니스 로직과 사용자 인터페이스가 변경되는 빈도가 다르다는 것이다.<br>
<!-- -->하향식 접근법은 비즈니스 로직과 사용자 인터페이스를 한데 섞기 때문에 사용자 인터페이스를 변경하는 경우 비즈니스 로직도 영향을 받는다.<br>
<!-- -->사용자 인터페이스를 변경하기 위해서는 전체 설계를 변경해야 한다.</p><p>하향식 접근법은 설계 초기 단계부터 구현을 염두하기 때문에 시간 제약을 강제한다. 소프트웨어가 <strong>무엇</strong>을 해결하는지에 초점을 두지 않고 <strong>어떻게</strong>동작하는지에 초점을 둔다.<br>
<!-- -->메인 함수가 다른 작은 함수들로 분해되기 위해서는 우선 함수들의 실행 순서를 결정해야 한다.<br>
<!-- -->실행 순서나 조건, 반복과 같은 구조를 미리 결정하지 않고는 분해를 진행할수 없기 때문에 기능 분해 방식은 중앙 집중 제어 스타일의 형태를 띌 수 밖에 없다.<br>
<!-- -->문제는 중요한 설계 결정 사항인 함수의 제어 구조가 빈번한 변경의 대상이라는 것이다. 기능이 추가하거나 변경하는 작업은 매번 기존에 결정된 함수의 제어구조를 변경하도록 만든다.
하향식 설계와 관련된 모든 문제의 원인은 결합도다. 분해된 함수들이 상위 함수의 문맥에 강하게 결합되어있다. 가장 큰 문제는 시스템의 핵심적인 구조를 결정하는 함수가 데이터에 강하게 결합되어있다는 것이다.</p><p>하향식 접근법은 어떤 함수가 어떤 데이터를 사용하고있는지를 알기 어렵다. 단순히 텍스트 검색으로 찾아낼 수 있는 문제가 아니라 모든 함수를 열어 해당 데이터를 사용하는지를 확인해봐야 하기 때문이다.<br>
<!-- -->만약 데이터의 구조가 변경되었다면 그 파급효과는 시스템 전체에 영향을 미칠 것이다. 어떤 데이터가 어떤 함수에 의존하고 있는지를 알아야 변경을 적용할 수 있기 때문에 작업에 필요한 노력도 커진다.<br>
<!-- -->데이터 변경으로 인한 영향을 최소화 하려면 데이터에 의존하는 부분과 아닌 부분을 명확하게 분리해야한다. 잘 정의된 퍼블릭 인터페이스를 통해 데이터로의 접근을 통제해야 한다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="언제-하향식-분해가-유용한가">언제 하향식 분해가 유용한가?<a href="#언제-하향식-분해가-유용한가" class="hash-link" aria-label="Direct link to 언제 하향식 분해가 유용한가?" title="Direct link to 언제 하향식 분해가 유용한가?">​</a></h3><p>설계가 어느 정도 안정화 된 후에 설계의 다양한 측면을 논리적으로 설명하고 문서화 할때 하향식 분해는 유용한 접근법으로 사용할 수 있다.</p><blockquote><p>하향식 접근은 완전히 이해된 사실을 서술하기에 적합한 방법이다.<!-- -->[Michael Jackson.]</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="모듈">모듈<a href="#모듈" class="hash-link" aria-label="Direct link to 모듈" title="Direct link to 모듈">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="정보-은닉과-모듈">정보 은닉과 모듈<a href="#정보-은닉과-모듈" class="hash-link" aria-label="Direct link to 정보 은닉과 모듈" title="Direct link to 정보 은닉과 모듈">​</a></h3><p>기능을 기반으로 시스템을 분해하는 것이 아닌, 변경의 방향에 맞춰 시스템을 분해하는 것이다. 함께 변경되는 부분을 하나의 구현 단위로 묶고 퍼블릭 인터페이스를 통해서만 접근되도록 하는 것이다.<br>
<!-- -->정보 은닉은 시스템을 모듈 단위로 분해하기 위한 기본 원리로 자주 변경되는 부분을 상대적으로 덜 변경되는 안정적인 인터페이스 뒤로 감춰야 한다는 것이 핵십이다.</p><p>모듈은 두 가지의 비밀을 감춰야 한다.</p><ul><li>복잡성
모듈이 너무 복잡한경우 이해하고 사용하기 어렵다. 외부에 모듈을 추상화할 수 있는 간단한 인터페이스를 제공해서 모듈의 복잡도를 낮춘다.</li><li>변경 가능성
변경 가능한 설계 결정이 외부에 노출될 경우 실제로 변경이 발생했을때 파급효과가 커진다.<br>변경 발생시 하나의 모듈만 수정하면 되도록 변경 가능한 설계 결정을 모듈 내부로 감추고 외부에는 쉽게 변경되지 않을 인터페이스를 제공한다.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="모듈의-장점과-한계">모듈의 장점과 한계<a href="#모듈의-장점과-한계" class="hash-link" aria-label="Direct link to 모듈의 장점과 한계" title="Direct link to 모듈의 장점과 한계">​</a></h3><p>모듈 분해의 장점은 다음과 같다.</p><ul><li>모듈 내부의 변수가 변경되더라도 모듈 내부에만 영향을 미친다.</li><li>비즈니스 로직과 사용자 인터페이스에 대한 관심사를 분리한다.</li><li>전역 변수와 전역 함수를 제거함으로써 네임스페이스 오염(namespace pollution)을 방지한다.</li></ul><p>모듈은 변경의 정도에 따라 모아놓은 기능의 집합이기 때문에 모듈 내부는 높은 응집도를 유지한다. 또한 모듈 간의 통신은 외부로 공개한 퍼블릭 인터페이스를 통해서만 가능하기 때문에 낮은 결합도를 유지한다.<br>
<!-- -->중요한 것은 모듈 분해는 기능을 데이터 중심으로 분해하게 된다는 것이다. 즉 데이터에 강하게 결합되어 데이터 변경시의 파급 효과에 대한 문제점은 여전히 남아있게된다.<br>
<!-- -->또한 인스턴스의 개념을 제공하지 않기 때문에 런타임시의 타입이 고정되어버린다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="데이터-추상화와-추상-데이터-타입">데이터 추상화와 추상 데이터 타입<a href="#데이터-추상화와-추상-데이터-타입" class="hash-link" aria-label="Direct link to 데이터 추상화와 추상 데이터 타입" title="Direct link to 데이터 추상화와 추상 데이터 타입">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="추상-데이터-타입">추상 데이터 타입<a href="#추상-데이터-타입" class="hash-link" aria-label="Direct link to 추상 데이터 타입" title="Direct link to 추상 데이터 타입">​</a></h3><p>모듈 분해보다 더 높은 수준의 추상화를 위해 등장한 개념으로 같은 타입의 여러 인스턴스를 독립적으로 존재할 수 있게 하는 개념이다.</p><blockquote><p>추상 데이터 타입은 추상 객체의 클래스를 정의한 것으로 추상 객체에 사용할 수 있는 오퍼레이션을 이용해 규정된다.
추상 데이터 객체를 사용할 때 프로그래머는 오직 객체가 외부에 제공하는 행위에만 관심을 가지며 행위가 구현되는 세부적인 사항에 대해서는 무시한다.<br>
<strong>[<!-- -->Liskov74<!-- -->]</strong></p></blockquote><p>추상 데이터 타입을 구현하기 위해서는 아래와 같은 언어의 지원이 필요하다.</p><ul><li>타입 정의 선언</li><li>타입의 인스턴스를 다룰 수 있는 오퍼레이션의 집합의 정의</li><li>데이터를 외부로부터 보호<ul><li>제공된 오퍼레이션을 통해서만 조작</li></ul></li><li>하나의 타입에 대해 복수의 인스턴스를 생성</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="클래스">클래스<a href="#클래스" class="hash-link" aria-label="Direct link to 클래스" title="Direct link to 클래스">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="클래스는-추상-데이터-타입인가">클래스는 추상 데이터 타입인가?<a href="#클래스는-추상-데이터-타입인가" class="hash-link" aria-label="Direct link to 클래스는 추상 데이터 타입인가?" title="Direct link to 클래스는 추상 데이터 타입인가?">​</a></h3><table><thead><tr><th>클래스</th><th>추상 데이터 타입</th></tr></thead><tbody><tr><td>상속과 다형성 지원 O</td><td>상속과 다형성 지원 X</td></tr><tr><td>객체 지향 프로그래밍</td><td>객체기반 프로그래밍</td></tr></tbody></table><p>클래스와 추상 데이터 타입은 다르다. 클래스는 절차를 추상화한 것이고, 추상 데이터 타입은 타입을 추상화 한 것이기 때문이다.</p><p>추상 데이터 타입이 오퍼레이션을 기준으로 타입을 묶는 방법이라면, 클래스는 타입을 기준으로 오퍼레이션을 묶는다.<br>
<!-- -->즉, 복수의 타입을 명시적으로 정의하고 두 타입에 관련된 오퍼레이션의 실행 절차를 두 타입에 분배한다.<br>
<!-- -->절차 분배시에 발생하는 동일한 동작은 간단하게 부모 클래스에 정의하고 이를 상속 받는 것으로 제공할 수 있다.  </p><p>클라이언트의 관점에서 두 클래스의 인스턴스는 동일하게 보인다. 내부에서 수행되는 절차는 다르지만, 클래스를 이용한 다형성은 절차에 대한 차이점을 감춘다.</p>]]></content:encoded>
            <category>Object</category>
            <category>Book Study</category>
            <category>OOP</category>
        </item>
        <item>
            <title><![CDATA[[오브젝트] Chapter06. 메시지와 인터페이스]]></title>
            <link>https://rhdtl78.github.io/dev-blog/object/chapter/06</link>
            <guid>https://rhdtl78.github.io/dev-blog/object/chapter/06</guid>
            <pubDate>Sun, 24 Jan 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[객체지향 프로그래밍]]></description>
            <content:encoded><![CDATA[<p>클래스는 객체지향 프로그래밍을 위한 도구로서 많은 개발자들이 객체지향에 대해 생각하면 떠오르는 키워드일 것이다. 그러나 클래스는 프로그래밍 도구일 뿐 설계를 클래스에 초점을 두어선 안된다.<br>
<!-- -->정말 중요한 것은 객체들이 주고 받는 메시지이며 이 메시지가 객체의 퍼블릭 인터페이스를 결정하고, 클래스를 결정한다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="협력과-메시지">협력과 메시지<a href="#협력과-메시지" class="hash-link" aria-label="Direct link to 협력과 메시지" title="Direct link to 협력과 메시지">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="클라이언트---서버-모델">클라이언트 - 서버 모델<a href="#클라이언트---서버-모델" class="hash-link" aria-label="Direct link to 클라이언트 - 서버 모델" title="Direct link to 클라이언트 - 서버 모델">​</a></h3><blockquote><p>협력은 어떤 객체가 다른 객체에게 무언가를 요청할 때 시작된다. <!-- -->[위프스브록(Wirfs-Brock03)]</p></blockquote><p>메시지를 매개로 하는 요청과 응답의 조합이 두 객체 사이의 협력을 결정한다. 두 객체 사이의 협력 관계를 설명하기 위한 전형적인 메타포는 <strong>클라이언트 - 서버(Client - Server) 모델</strong> 이다.<br>
<!-- -->클라이언트가 서버의 서비스를 요청하는 단방향 상호작용을 협력으로써 활용한다. 객체지향 관점에서 클라이언트는 메시지를 보내는 주체가 되는 객체이며 서버는 메시지를 수신받은 협력 객체이다.  </p><p>객체는 협력에 참여하는 동안 클라이언트와 서버의 역할을 동시에 수행하는 것이 일반적이다. 객체 외부로 전송하는 메시지의 집합과 외부의 객체로부터 수신하는 메시지의 집합의 두 가지의 메시지 집합으로 구성된다.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="메시지와-메시지-전송">메시지와 메시지 전송<a href="#메시지와-메시지-전송" class="hash-link" aria-label="Direct link to 메시지와 메시지 전송" title="Direct link to 메시지와 메시지 전송">​</a></h3><p><strong>메시지 (Message)</strong></p><ul><li>객체들이 협력하기 위해 사용할 수 있는 유일한 의사소통 수단이다.</li><li>다른 객체에게 도움을 요청하는 것을 <strong>메시지 전송(message sending)</strong> 또는 <strong>메시지 패싱(message passing)</strong>이라 한다.</li><li>메시지를 전송하는 객체를 <strong>메시지 전송자(message sender)</strong>, 수신하는 객체를 <strong>메시지 수신자(message receiver)</strong> 라 한다. </li><li>클라이언트 - 서버 모델에선 메시지 전송자를 클라이언트, 메시지 수신자를 서버라 할 수 있다.</li><li>오퍼레이션 명 (operation name) + 인자 (argument)로 구성.</li><li>메시지 전송 = <!-- -->[메시지 수신자]<!-- --> + <!-- -->[오퍼레이션 명]<!-- --> + <!-- -->[인자]<!-- -->.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="메시지와-메서드">메시지와 메서드<a href="#메시지와-메서드" class="hash-link" aria-label="Direct link to 메시지와 메서드" title="Direct link to 메시지와 메서드">​</a></h3><p>메시지를 수신했을 때 실제로 어떤 코드가 실행되는지는 메시지 수신자의 실제 타입이 무엇이가에 달려있다. 메시지를 수신했을 때 실제로 실행되는 함수 또는 프로시저를 <strong>메서드</strong>라 한다.<br>
<!-- -->메시지와 메서드의 구분은 메시지 전송자와 메시지 수신자가 느슨하게 결합될 수 있게 한다. 전송자는 전송할 메시지만 알면 되고 수신자는 받은 메시지를 자율적으로 처리하면 된다.<br>
<!-- -->이렇게 실행 시점에 메시지와 메서드를 바인등하는 메커니즘은 객체간의 결합도를 낮춰 확장 가능한 코드를 작성할 수 있게 한다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="퍼블릭-인터페이스와-오퍼레이션">퍼블릭 인터페이스와 오퍼레이션<a href="#퍼블릭-인터페이스와-오퍼레이션" class="hash-link" aria-label="Direct link to 퍼블릭 인터페이스와 오퍼레이션" title="Direct link to 퍼블릭 인터페이스와 오퍼레이션">​</a></h3><p>객체의 내부는 해당 객체만이 알고있다. 외부에선 장막으로 가린 듯이 명확하게 구분되어있다. 이러한 외부와 단절된 객체가 의사소통을 위해 외부에 공개하는 메시지의 집합을 <strong>퍼블릭 메인터페이스</strong>라 한다.<br>
<!-- -->프로그래밍 언어의 관점에서 퍼블릭 인터페이스에 포함된 메시지를 오퍼레이션(operation)이라고 부른다. 런타임에서 메시지 전송자가 메시지를 보내면 메시지 수신자는 실제 타입을 기반으로 적절한 메서드를 찾아 실행한다.<br>
<!-- -->퍼블릭 인터페이스와 메시지의 관점에서 보면 '메서드 호출'보다는 '오퍼레이션 호출'이라는 용어가 더 적절한 표현이다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="시그니처">시그니처<a href="#시그니처" class="hash-link" aria-label="Direct link to 시그니처" title="Direct link to 시그니처">​</a></h3><p>오퍼레이션(또는 메서드)의 이름과 파라미터 목록을 합쳐 <strong>시그니처 (signature)</strong>라고 한다. 오퍼레이션은 실행 코드 없이 시그니처만을 정의한 것이다.</p><ul><li>메서드 = 시그니처 + 구현</li><li>시그니처 = 오퍼레이션 명 + 인자</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="인터페이스와-품질">인터페이스와 품질<a href="#인터페이스와-품질" class="hash-link" aria-label="Direct link to 인터페이스와 품질" title="Direct link to 인터페이스와 품질">​</a></h2><p>퍼블릭 인터페이스의 품질에 영향을 미치는 4가지 원칙</p><ul><li>디미터 법칙</li><li>묻지 말고 시켜라</li><li>의도를 드러내는 인터페이스</li><li>명령 - 쿼리 분리</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="디미터-법칙law-of-demeter">디미터 법칙(Law of Demeter)<a href="#디미터-법칙law-of-demeter" class="hash-link" aria-label="Direct link to 디미터 법칙(Law of Demeter)" title="Direct link to 디미터 법칙(Law of Demeter)">​</a></h3><p>객체의 내부 구조에 강하게 결합되지 않도록 협력 경로를 제한하는 원칙이다. </p><blockquote><p>낮선 자에게 말하지 마라 <!-- -->[Larman04]<!-- -->
오직 인접한 이웃하고만 말하라 <!-- -->[Metz12]<!-- -->
오직 하나의 도트만 사용하라 <!-- -->[Metz12]</p></blockquote><p>디미터 법칙을 따르기 위해서는 클래스가 특정한 조건을 만족하는 대상에게만 메시지를 전송하도록 제한해야 한다.  </p><blockquote><p>모든 클래스 C와 C에 구현된 모든 메서드 M에 대해 </p><ul><li>M의 인자로 전달된 클래스</li><li>C의 인스턴스 변수의 클래스</li></ul></blockquote><p>이를 좀더 구체화 해보면 아래와 같이 나열할 수 있다.</p><blockquote><ul><li>this 객체</li><li>메서드의 매개변수</li><li>this의 속성</li><li>this의 속성인 컬렉션의 요소</li><li>메서드 내에서 생성된 지역 객체</li></ul></blockquote><p>디미터의 법칙을 따르면 <strong>부끄럼타는 코드(shy code)</strong> 를 작성할 수 있다. 즉, 불필요한 어떤 것도 외부에 공개하지 않으며 다른 객체의 구현에 의존하지 않는 코드를 작성 할 수 있다.<br>
<!-- -->이로 인해 클라이언트와 서버 사이에 낮은 결합도를 유지할 수 있다. </p><p>디미터 법칙을 위반하는 코드의 경우 아래와 같은 모습일 것이다.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getB</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">doSometing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>각 메서드의 결과 반환 타입이 A -&gt; B -&gt; C로 변화하는 것을 알 수 있다. 이 로직을 사용하는 부분은 A, B, C 모두에게 결합되어 유연하지 못한 코드가 된다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="묻지말고-시켜라">묻지말고 시켜라<a href="#묻지말고-시켜라" class="hash-link" aria-label="Direct link to 묻지말고 시켜라" title="Direct link to 묻지말고 시켜라">​</a></h3><p>훌륭한 메시지는 객체의 상태에 관해 묻지 말고 원하는 것을 시키는 것이다. 메시지 전송자는 메시지 수신자의 상태를 기반으로 결정을 내린 후 메시지 수신자의 상태를 바꿔서는 안된다.<br>
<!-- -->모든 구현되는 로직은 메시지 수자가 담당해야할 책임인 것이다.</p><p>묻지 말고 시켜라 원칙을 따르도록 메시지를 결정하면 자연스럽게 정보 전문가에게 책임을 할당하게 되고 높은 응집도를 가진 클래스를 얻을 확률이 높아진다.<br>
<!-- -->객체 내부의 상태를 이용해 어떤 결정을 내리는 로직이 객체 외부에 존재한다면 해당 객체가 책임져야하는 어떤 행동이 객체 외부로 누수된 것이다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="의도를-드러내는-인터페이스">의도를 드러내는 인터페이스<a href="#의도를-드러내는-인터페이스" class="hash-link" aria-label="Direct link to 의도를 드러내는 인터페이스" title="Direct link to 의도를 드러내는 인터페이스">​</a></h3><p>메서드의 이름을 짓는 방법에는 두 가지가 있다. </p><ul><li>메서드의 내부 구현 방법을 드러내는 이름 (어떻게 동작하는가?)</li><li>메서드가 짊어진 책임이 무엇인지를 드러내는 이름 (무엇을 하는가?)</li></ul><p>첫 번째의 경우는 나쁘지는 않지만 다형성과 같은 기법을 사용하기 어려워진다. 같은 역할의 다른 구현인 객체는 모두 다른 메서드 이름을 갖게 될 것이기 때문이다. 더 큰 문제는 메서드 수준에서 이미 캡슐화를 위반한다는 것이다.<br>
<!-- -->이런 이름의 메서드들은 협력하는 객체의 종류를 알도록 강요한다.
두 번째의 경우를 따르게 되면 프로그래머는 메서드가 하는 일에 대한 충분한 정보를 보여주며 역할과 책임에 기반한 코드를 작성할 수 있다.<br>
<!-- -->이 원칙에서 중요한 것은 구현과 관련된 모든 정보를 캡슐화하고 객체의 퍼블릭 인터페이스에는 협력과 관련된 의도만을 표현한다는 것이다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="원칙의-함정">원칙의 함정<a href="#원칙의-함정" class="hash-link" aria-label="Direct link to 원칙의 함정" title="Direct link to 원칙의 함정">​</a></h2><p>디미터 원칙과 묻지말고 시켜라 스타일은 객체지향에서 좋은 원칙임에는 분명하다. 그러나 그 어떤 원칙도 절대적인 것은 아니다.<br>
<!-- -->설계는 트레이드오프의 결과물이라는 사실을 잊지 말아야 한다. 적용하려는 원칙이 충돌하는 상황에서도 원칙에 너무 얽메여 억지로 끼워맞추는 상황이 발생하고 결과적으로 설계는 일관성을 잃고 코드는 무질서 속에 파묻히게 된다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="디미터-법칙은-하나의-도트를-강제하는-규칙이-아니다">디미터 법칙은 하나의 도트(.)를 강제하는 규칙이 아니다.<a href="#디미터-법칙은-하나의-도트를-강제하는-규칙이-아니다" class="hash-link" aria-label="Direct link to 디미터 법칙은 하나의 도트(.)를 강제하는 규칙이 아니다." title="Direct link to 디미터 법칙은 하나의 도트(.)를 강제하는 규칙이 아니다.">​</a></h3><p>앞서 말한 디미터 법칙에서 단 하나의 도트를 사용하라<!-- -->[Metz12]<!-- -->고 했었다. 이를 보고 대부분의 사람들이 IntStream이 디비터 법칙을 위반했다고 생각할 것이다.<br>
<!-- -->그러나 IntStream의 메서드는 다른 어떤 것을 반환하지 않고 또다른 IntStream의 인스턴스를 반환한다. A 가 B 가 되는 것이 아닌 A 가 A'이 되는 것일 뿐이다.<br>
<!-- -->디미터 법칙은 결합도와 관련된 것이며 결합도가 문제가 되는 것은 객체의 내부 구조가 외부로 노출되는 경우로 한정된다.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="결합도와-응집도의-충돌">결합도와 응집도의 충돌<a href="#결합도와-응집도의-충돌" class="hash-link" aria-label="Direct link to 결합도와 응집도의 충돌" title="Direct link to 결합도와 응집도의 충돌">​</a></h3><p>묻지말고 시켜라와 디미터 법칙을 준수하는 것이 항상 긍정적인 결과로만 귀결되는 것은 아니다. 같은 퍼블릭 인터페이스 안에 어울리지 않는 오퍼레이션들이 공존하게 된다. 결과적으로 객체는 필요없는 책임을 지게 되어 응집도가 낮아진다. </p><p>가끔씩은 객체의 상태를 묻는것 외에 다른 방법이 없는 경우도 있다. 컬렉션에 포함된 객체들을 처리하는 유일한 방법은 객체에게 물어보는 것 뿐이다. 객체가 정말로 데이터인 경우에는 묻지 않고서는 처리항 방법이 없다.<br>
<!-- -->객체에게 시키는 것이 항상 가능한 것은 아니다. 늘 "경우에 따라 다르다"라는 사실을 명심해야한다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="명령-쿼리-분리-원칙">명령 쿼리 분리 원칙<a href="#명령-쿼리-분리-원칙" class="hash-link" aria-label="Direct link to 명령 쿼리 분리 원칙" title="Direct link to 명령 쿼리 분리 원칙">​</a></h2><p><strong>명령 - 쿼리 분리(Command - Operation Separation) 원칙</strong>은 퍼블릭 인터페이스에 오퍼레이션을 정의할 때 참고할 수 있는 지침을 제공한다.</p><ul><li>어떤 절차를 묶어 호출 가능하도록 이름을 부여한 기능 모듈을 <strong>루틴(routine)</strong> 이라 한다.  </li><li>루틴은 프로시저와 함수로 구분할 수 있다.</li><li>프로시저는 부수효과를 발생시킬 수 있지만 값을 반환할 수 없다.</li><li>함수는 값을 반환할 수 있지만 부수 효과를 발생시킬 수 없다. </li></ul><p><strong>명령(Command)</strong> 과 <strong>쿼리(Query)</strong> 는 객체의 인터페이스 측면에서 프로지서와 함수를 부르는 또 다른 이름이다.  </p><ul><li>객체의 상태를 변경하는 명령은 반환값을 가질 수 없다. </li><li>객체의 정보를 변환하는 쿼리는 상태를 변경할 수 없다. </li></ul><p>어떤 오퍼레이션도 명령인 동시에 쿼리여서는 안된다. 명령-쿼리 분리 원칙을 한 문장으로 표현하면 "질문이 답변을 수정해서는 안된다." 는 것이다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="명령-쿼리-분리와-참조-투명성">명령-쿼리 분리와 참조 투명성<a href="#명령-쿼리-분리와-참조-투명성" class="hash-link" aria-label="Direct link to 명령-쿼리 분리와 참조 투명성" title="Direct link to 명령-쿼리 분리와 참조 투명성">​</a></h3><p><strong>참조 투명성 (referential transparency)</strong> 이란 어떤 표현식 e가 있을 때 e의 값으로 e가 나타나는 모든 위치를 교체하더라도 결과가 달라지지 않는 특성을 의미한다. </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">f(1) + f(1) = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f(1) * 2 = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f(1) - 1 = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 + 3 = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 * 2 = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 - 1 = 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>참조 투명성을 만족하는 식은 두 가지 장점을 제공한다.</p><ul><li>모든 함수를 이미 알고 잇는 하나의 결과값으로 대체할 수 있기 때문에 쉽게 계산할 수 있다.</li><li>모든 곳에서 함수의 결과값이 동일하기 때문에 식의 순서를 변경하더라도 각 식의 결과는 달라지지 않는다. </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="책임에-초점을-맞춰라">책임에 초점을 맞춰라<a href="#책임에-초점을-맞춰라" class="hash-link" aria-label="Direct link to 책임에 초점을 맞춰라" title="Direct link to 책임에 초점을 맞춰라">​</a></h3><p>앞서 소개된 원칙들의 장점을 정리하면 다음과 같다. </p><blockquote><ul><li><strong>디미터 법칙</strong><br>협력이라는 컨텍스트 안에서 객체보다 메시지를 먼저 결정하면 두 객체 사이의 구조적인 결합도를 낮출 수 있다. 수신할 객체를 알지 못한 상태에서 메시지를 먼저 선택하기 때문에 객체의 내부 구조에 대해 고민할 필요가 없어진다.<br>따라서 메시지가 객체를 선택하게 함으로써 의도적으로 디미터 법칙을 위반할 위험을 최소화할 수 있다. </li><li><strong>묻지 말고 시켜라</strong><br>메시지 를 먼저 선택하면 묻지 말고 시켜라 스타일에 따라 협력을 구조화하게 된다. 클라이언트의 관점에서 메시지를 선택하기 때문에 필요한 정보를 물을 필요 없이 원하는 것을 표현한 메시지를 전송하면 된다. </li><li><strong>의도를 드러내는 인터페이스</strong><br>메시지를 먼저 선택한다는 것은 메시지를 전송하는 클라이언트의 관점에서 메시지의 이름을 정한다는 것이다. 당연히 그 이름에는 클라이언트가 무엇을 원하는지, 그 의도가 분명하게 드러날 수 밖에 없다. </li><li><strong>명령-쿼리 분리 원칙</strong><br>메시지를 먼저 선택한다는 것은 협력이라는 문맥 안에서 객체의 인터페이스에 관해 고민한다는 것을 의마한다. 객체가 단순히 어떤 일을 해야하는지 뿐만 아니라 협력 속에서 객체의 상태를 예측하고 이해하기 쉽게 만들기 위한 방법에 관해 고민하게 된다.<br>따라서 예측 가능한 협력을 만들기 위해 명령과 쿼리를 분리하게 될 것이다. </li></ul></blockquote><p>훌륭한 메시지를 얻기 위해서는 책임 주도 설계 원칙을 따라야 한다. 객체가 메시지를 선택하는 것이 아니라 메시지가 객체를 선택하는 것이기 때문에 적합한 메시지를 결정할 수 있을 확률이 높아진다.</p>]]></content:encoded>
            <category>Object</category>
            <category>Book Study</category>
            <category>OOP</category>
        </item>
        <item>
            <title><![CDATA[[오브젝트] Chapter05. 책임 할당하기. - GRASP Pattern]]></title>
            <link>https://rhdtl78.github.io/dev-blog/object/chapter/05</link>
            <guid>https://rhdtl78.github.io/dev-blog/object/chapter/05</guid>
            <pubDate>Tue, 19 Jan 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[객체지향 프로그래밍]]></description>
            <content:encoded><![CDATA[<p>책임에 초점을 맞춰 설계할 때 가장 큰 어려움은 어떤 객체에게 어떤 책임을 할당할지를 결정하기 쉽지 않다는 것이다.<br>
<!-- -->모든 책임 활동은 트레이드오프 활동이며, 여러 방법중 최선의 할당 방법을 선택하는 것이다.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="책임-주도-설계를-향해">책임 주도 설계를 향해<a href="#책임-주도-설계를-향해" class="hash-link" aria-label="Direct link to 책임 주도 설계를 향해" title="Direct link to 책임 주도 설계를 향해">​</a></h2><p>책임 중심 설계를 위한 2가지 원칙</p><ul><li>데이터보다 행동을 먼저 결정하라</li><li>협력이라는 문맥 안에서 책임을 결정하라. </li></ul><p>위의 두 원칙의 핵심은 객체를 데이터가 아닌 협력을 중심으로 생각하는 것이다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="데이터보다-행동을-먼저-결정하라">데이터보다 행동을 먼저 결정하라.<a href="#데이터보다-행동을-먼저-결정하라" class="hash-link" aria-label="Direct link to 데이터보다 행동을 먼저 결정하라." title="Direct link to 데이터보다 행동을 먼저 결정하라.">​</a></h3><p>데이터는 객체가 책임을 수행하는 데 필요한 재료를 제공할 뿐이다. 책임 중심 설계는 "이 객체가 수행헤야할 책임은 무엇인가?"를 먼저 결정한 후에<br>
<!-- -->"이 책임을 수행하는데 필요한 데이터는 무엇인가"를 결정한다. 책임을 먼저 결정한 후에 객체의 상태를 결정하는 것이다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="협력이라는-문맥-안에서-책임을-결정하라">협력이라는 문맥 안에서 책임을 결정하라.<a href="#협력이라는-문맥-안에서-책임을-결정하라" class="hash-link" aria-label="Direct link to 협력이라는 문맥 안에서 책임을 결정하라." title="Direct link to 협력이라는 문맥 안에서 책임을 결정하라.">​</a></h3><p>책임은 객체의 입장이 아니라 객체가 참여하는 협력에 적합해야 한다. 협력은 메시지를 전송하는 객체로부터 시작되기 때문에 적합한 책임이란 메시지 전송자에게 적합한 책임을 의미한다.<br>
<!-- -->즉, 메시지를 전송하는 클라이언트에게 적합한 책임을 할당해야 한다.</p><p>객체를 결정한 후에 메시지를 선택하는것이 아닌, 메시지를 결정한 후에 적합한 객체를 선택해야 한다. 메시지가 존재하기 때문에 객체가 존재하는 것이다. </p><blockquote><p>객체를 갖고있기 때문에 메시지를 보내는것이 아니다. 메시지를 전송하기 때문에 객체를 갖게 된 것이다.<!-- -->[Metz12]<!-- -->.</p></blockquote><p>문맥 안에서 메시지에 집중하는 책임은 더 깔끔하고 수월하게 캡슐화의 원칙을 지켜낼 수 있다. 반면 데이터 중심의 설계는 내부의 상태를 밖에서 알아야하기 때문에 캡슐화가 약화된다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="책임-주도-설계">책임 주도 설계<a href="#책임-주도-설계" class="hash-link" aria-label="Direct link to 책임 주도 설계" title="Direct link to 책임 주도 설계">​</a></h3><p>핵심은 책임을 결정한 후에 책임을 수행할 객체를 결정하는 것이다. 협력에 참여하는 객체들의 책임이 어느정도 정리될 때까지는 객체 내부의 상태에는 관심을 가지지 않는다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="책임-할당을-위한-grasp-패턴">책임 할당을 위한 GRASP 패턴<a href="#책임-할당을-위한-grasp-패턴" class="hash-link" aria-label="Direct link to 책임 할당을 위한 GRASP 패턴" title="Direct link to 책임 할당을 위한 GRASP 패턴">​</a></h2><p>GRASP 패턴이란?</p><ul><li>General Responsibility Assignment Software Pattern <!-- -->[Craig Larman]</li><li>일반적 책임 할당을 위한 소프트웨어 패턴</li><li>객체에게 책임을 할당할 때 지침으로 사용할 수 있는 원칙들</li><li>총 9가지 원칙<ul><li>Information Expert (정보 전문가)</li><li>Creator (창조자)</li><li>Controller (조율자)</li><li>Low coupling (낮은 결합도)</li><li>Polymorphism (다형성)</li><li>Pure fabrication (순수 제작?)</li><li>Indirection (간접 참조)</li><li>Protected variation (변경 보호)</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="도메인-개념에서-출발하기">도메인 개념에서 출발하기<a href="#도메인-개념에서-출발하기" class="hash-link" aria-label="Direct link to 도메인 개념에서 출발하기" title="Direct link to 도메인 개념에서 출발하기">​</a></h3><p>어떤 책임을 할당할 때 가장 먼저 고려해야할 것은 도메인이다. 도메인 안에는 무수히 많은 개념이 존재하며 도메인의 개념들을 책임 할당의 대상을 생각하면 좀더 수월하다.
그러나 도메인 개념을 정리하는데 오랜 시간을 할애해서는 안된다. 완벽한 도메인 모델이란 존재하지 않고, 정말 중요한 것은 설계를 시작하는 것이기 때문이다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="정보-전문가에게-책임을-할당하라">정보 전문가에게 책임을 할당하라<a href="#정보-전문가에게-책임을-할당하라" class="hash-link" aria-label="Direct link to 정보 전문가에게 책임을 할당하라" title="Direct link to 정보 전문가에게 책임을 할당하라">​</a></h3><p>앞서 2장에서 본 내용이다. 어떤 책임을 수행하기에 가장 적합한 객체는 그 책임에 대해 가장 잘 알고 가장 잘 할수 있는 객체이다.
가장 처음 객체에게 책임을 할당하기 위한 질문은 어떤 메시지가 필요한지에 대한 질문이다.</p><blockquote><p>메시지를 전송할 객체는 무엇을 원하는가?</p></blockquote><p>이는 해결해야할 문제를 파악하는 질문이기도 하다. 해결해야할 문제가 무엇이고 해결하기 위해서 필요한 메시지는 무엇인지를 찾는다.</p><p>메시지를 결정한 다음으로 생각해야할 질문을 이 메시지를 처리할 객체는 무엇인가에 대한 질문이다.</p><blockquote><p>메시지를 수신할 적합한 객체는 누구인가?</p></blockquote><p>이 질문에 답하기 위해서는 객체가 상태화 행동을 통합한 캡슐화의 단위라는 사실에 집중해야 한다. 객체의 책임과 책임을 수행하는데 필요한 상태는 동일한 객체 내에 존재해야 한다.
따라서 객체에게 책임을 할당하는 첫 번째 원칙은 정보 전문가에게 책임을 할당하는 것이다.</p><p>정보 전문가 패턴(Information Expert pattern)은 객체가 자신이 소유하고 있는 정보와 관련된 작업을 수행한다는 일반적인 직관을 표현한 것이다.<br>
<!-- -->여기서 한가지 중요한 것은 <strong>정보 !== 데이터</strong> 라는 사실이다. 객체가 정보를 필요로 한다 해서 꼭 <strong>저장</strong> 하고있을 필요는 없다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="높은-응집도와-낮은-결합도">높은 응집도와 낮은 결합도<a href="#높은-응집도와-낮은-결합도" class="hash-link" aria-label="Direct link to 높은 응집도와 낮은 결합도" title="Direct link to 높은 응집도와 낮은 결합도">​</a></h3><p>높은 응집도와 낮은 결합도는 객체에 책임을 할당할 때에 항상 고려해야 하는 기본 원리이다. 객체가 자신의 밖의 내용을 많이 알 수록 결합도는 높아지며  내부에만 집중할 수록 응집도는 높아진다.  </p><p><img loading="lazy" alt="높은 결합도" src="/assets/images/coupling-4e6bad9b0281278229b4c73a29b993bc.jpg" width="978" height="590" class="img_ev3q">
위 그림은 높은 결합도를 간략히 그림으로 나타낸 것이다. D 객체에서 C 객체가 참조하고있는 내용에 변경이 생기면 C 객체도 변경해야 하며 이 변경은 다시 C 객체의 내부에 의존하고있는 다른 객체에게도 전파된다.  </p><p><img loading="lazy" alt="높은 응집도" src="/assets/images/cohesion-77314f61df68db48a5ae1077cf0a9951.jpg" width="913" height="832" class="img_ev3q">
위 그림은 각 객체가 높은 응집도를 보일 경우를 그림으로 표현한 것이다. 각 객체의 관심은 내부에 집중되어있기 때문에 각 객체의 변경은 외부를 오염시키지 않고 객체 내부에서만 유지된다. </p><p>낮은 결합도와 높은 응집도는 개발 이후의 유지 보수성을 높여준다. 객체가 자기 자신에게 집중할 수록 변경은 외부로 흘러나가지 않고, 외부의 객체는 변경되지 않는 퍼블릭 인터페이스를 참조한다.<br>
<!-- -->Low Coupling(낮은 결합도)와 High Cohesion(높은 응집도)는 설계를 진행하면서 책임과 협력의 품질을 검토하는데 사용할 수 있는 중요한 평가 기준이다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="창조자에게-객체-생성-책임을-할당하라">창조자에게 객체 생성 책임을 할당하라.<a href="#창조자에게-객체-생성-책임을-할당하라" class="hash-link" aria-label="Direct link to 창조자에게 객체 생성 책임을 할당하라." title="Direct link to 창조자에게 객체 생성 책임을 할당하라.">​</a></h3><p>Creator 패턴의 의도는 어떤 방식으로든 생성되는 객체와 연결되거나 관련될 필요가 있는 객체에 해당 객체를 생성할 책임을 맞기는 것이다.<br>
<!-- -->이 둘은 이미 강한 결합을 갖고있기 때문에 이 객체에 생성 책임을 할당하는 설계의 전체적인 결합도에 영향을 미치지 않는다. 이미 존재하는 객체 사이의 관계를 사용하기 때문에 전체 설계는 낮는 결합도를 유지할 수 있다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="다형성을-통해-분리하기">다형성을 통해 분리하기<a href="#다형성을-통해-분리하기" class="hash-link" aria-label="Direct link to 다형성을 통해 분리하기" title="Direct link to 다형성을 통해 분리하기">​</a></h3><p>객체의 타입에 따라 행동이 달라진다면, 우선 객체를 타입으로 분리하고 행동을 각 타입의 책임으로 할당하는 방법을 GRASP에서는 Polymorphism이라 한다.<br>
<!-- -->로직의 분기를 if~else, switch~case 로만 분리한다면, 이후 유지보수시 수정을 어렵게하고 변경에 취약하게 만든다. 이때 다형성을 사용해 분리하게되면 확장성을 챙길 수 있게된다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="변경으로부터-보호하기">변경으로부터 보호하기<a href="#변경으로부터-보호하기" class="hash-link" aria-label="Direct link to 변경으로부터 보호하기" title="Direct link to 변경으로부터 보호하기">​</a></h3><p>Protected Variation(변경 보호)는 쉽게 말해 변경할 이유에 따라 분리하고, 캡슐화 하는 것을 말한다. 하나의 객체는 하나의 변경이유로만 변경해야 한다.<br>
<!-- -->하나의 변경을 위해 여러 객체를 변경해야 하는 것은 프로그램의 유연성을 떨어뜨리고 확장성을 떨어뜨린다. </p><p>이를 위해서는 변경 예상지점을 식별하고 그 주위에 안정된 인터페이스를 형성하도록 책임을 할당해야 한다. 변하는 것이 무엇인지 고려하고 변하는 개념을 캡슐화 하는 것은 변화의 전파를 최소화 한다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="변경과-유연성">변경과 유연성<a href="#변경과-유연성" class="hash-link" aria-label="Direct link to 변경과 유연성" title="Direct link to 변경과 유연성">​</a></h3><p>개발자들이 변경에 대비할 수 있는 방법은 두 가지가 있다. </p><ol><li>코드를 이해하고 수정하기 쉽도록 단순하게 작성</li><li>코드를 수정하지 않고도 변경을 수용할 수 있도록 유연하게 설계</li></ol><p>대부분의 경우 1.이 좋은 방법이지만, 코드가 빈번하게 반복될 경우 복잡성을 감수하더라도 2.를 하는것이 더 좋은 방법이다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="책임-주도-설계의-대안">책임 주도 설계의 대안<a href="#책임-주도-설계의-대안" class="hash-link" aria-label="Direct link to 책임 주도 설계의 대안" title="Direct link to 책임 주도 설계의 대안">​</a></h2><p>책임 주도 설계를 적용하는데 어려움이 있다면, 다음의 대안을 활용할 수 있다.<br>
<!-- -->우선 목표로 하는 기능을 우선 구현한 후, 해당 기능을 유지한 채 리팩터링 하는 것이다.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="메서드-응집도">메서드 응집도<a href="#메서드-응집도" class="hash-link" aria-label="Direct link to 메서드 응집도" title="Direct link to 메서드 응집도">​</a></h3><p>복잡한 기능을 구현하다보면 하나의 메서드가 프로세스와 같이 굉장히 길어지고 파악하기 어려워지는 경우가 생긴다. 이런 메서드를 몬스터 메서드라고 부른다. <!-- -->[Michael Feathers]<br>
<!-- -->대부분의 이런 메서드들은 응집도가 낮아 변경의 이유가 하나 이상이며 메서드 흐름을 파악하기 위한 주석이 필요하다. </p><p>응집도 높은 메서드는 변경의 이유가 단 하나여야 한다. 메서드의 흐름을 한 눈에 볼 수 있어야 하며 메서드의 흐름을 읽는 것 자체가 일련의 주석을 읽는 것과 같이 간결해야 한다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="객체를-자율적으로-만들자">객체를 자율적으로 만들자<a href="#객체를-자율적으로-만들자" class="hash-link" aria-label="Direct link to 객체를 자율적으로 만들자" title="Direct link to 객체를 자율적으로 만들자">​</a></h3><p>메서드의 응집도를 높여 분리했다면 객체의 응집도를 높일 차례다. 응집도 높은 메서드 중 객체의 책임에 맞지 않는 메서드를 올바른 책임을 진 객체로 옮기는 것이다.<br>
<!-- -->리팩터링 결과는 올바름 책임을 갖고, 하나의 관심사에 집중되어있는 설계를 얻게 된다. 높은 캡슐화, 높은 응집도, 낮은 결합도의 설계가 구현되는 것이다.</p>]]></content:encoded>
            <category>Object</category>
            <category>Book Study</category>
            <category>OOP</category>
        </item>
        <item>
            <title><![CDATA[[오브젝트] Chapter03. 역할, 책임, 협력.]]></title>
            <link>https://rhdtl78.github.io/dev-blog/object/chapter/03</link>
            <guid>https://rhdtl78.github.io/dev-blog/object/chapter/03</guid>
            <pubDate>Mon, 18 Jan 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[객체지향 프로그래밍]]></description>
            <content:encoded><![CDATA[<p>객체지향 패러다임의 관점에서 핵심은 <strong>역할(role), 책임(responsibility), 협력(collaboration)</strong> 이다.<br>
<!-- -->객체지향 설계의 핵심은 협력을 구성하기 위해 적쩔한 객체를 찾고 적절한 책임을 할당하는 과정에서 드러난다.</p><p>역할</p><ul><li>객체들이 협력 안에서 수행하는 책임들이 모여 객체가 수행하는 역할을 구성.
책임</li><li>객체가 협력에 참여하기 위해 수행하는 로직.
협력</li><li>애플리케이션의 기능을 구현하기위해 수행하는 상호작용.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="협력">협력<a href="#협력" class="hash-link" aria-label="Direct link to 협력" title="Direct link to 협력">​</a></h2><p>객체들은 혼자서 존재할 수 없다. 다른 객체와의 협력을 통해 기능을 구성한다. 다른 객체와의 협력할 수 있는 유일한 수단은 <strong>메시지 전송(message sending)</strong> 뿐이다.<br>
<!-- -->객체는 다른 객체의 상세한 내부 구현에 접근할 수 없기 때문에 오직 메시지 전송을 통해 자신의 요청을 전달한다.<br>
<!-- -->메시지를 수신한 객체는 메시지에 응답하기 위해 알아서 실행할 메서드를 골라 수행한다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="협력은-객체를-설계하는데-필요한-일종의-문맥context-를-제공한다">협력은 객체를 설계하는데 필요한 일종의 <strong>문맥(context)</strong> 를 제공한다.<a href="#협력은-객체를-설계하는데-필요한-일종의-문맥context-를-제공한다" class="hash-link" aria-label="Direct link to 협력은-객체를-설계하는데-필요한-일종의-문맥context-를-제공한다" title="Direct link to 협력은-객체를-설계하는데-필요한-일종의-문맥context-를-제공한다">​</a></h3><p>객체가 참여한ㄴ 협력이 객체를 구성하는 행동과 상태를 모두 결정한다.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="책임">책임<a href="#책임" class="hash-link" aria-label="Direct link to 책임" title="Direct link to 책임">​</a></h2><p>협력에 참여하기위해 객체가 수행하는 행동을 책임이라 한다. 책임은 객체에 의해 정의되는 응집도 있는 행위의 집합이다.<br>
<!-- -->크게 <strong>하는 것(doing)</strong> 과 <strong>아는 것(knowing)</strong> 의 두가지로 나누어 세분화 할 수 있다 <!-- -->[크레이그 라만]</p><p>하는 것</p><ul><li>객체를 생성하거나 계산을 수행 하는 등의 스스로 하는 것.</li><li>다른 객체의 행동을 시작시키는 것.</li><li>다른 객체의 활동을 제어하고 조절하는 것.</li></ul><p>아는 것</p><ul><li>사적인 정보에 관해 아는 것.</li><li>관련된 객체에 관해 아는 것.</li><li>자신이 유도하거나 계산할 수 있는 것에 관해 아는 것.</li></ul><p>일반적으로 책임과 메시지의 크기는 다르다. 책임은 객체가 수행해야 할 행동을 종합적이고 더 간략하게 서술하기 때문에 더 추상적이고 개념적으로도 더 크다.<br>
<!-- -->책임의 관점에서 아는 것과 하는 것이 밀접하게 연관되어있다. 어떤 책임을 수행하기 위해서는 그 책임을 수행하는데 필요한 정보도 함께 알아야 하기 때문이다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="책임-할당">책임 할당<a href="#책임-할당" class="hash-link" aria-label="Direct link to 책임 할당" title="Direct link to 책임 할당">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="information-expert-pattern-정보-전문가-패턴">INFORMATION EXPERT PATTERN (정보 전문가 패턴)<a href="#information-expert-pattern-정보-전문가-패턴" class="hash-link" aria-label="Direct link to INFORMATION EXPERT PATTERN (정보 전문가 패턴)" title="Direct link to INFORMATION EXPERT PATTERN (정보 전문가 패턴)">​</a></h4><p>책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당하는 방법이다. 이는 일상상활에서 어떤 문제를 해결하기 위해 그 분야의 전문가에게 도움을 구하는 것과 같다.<br>
<!-- -->그 전문가 객체는 자율적으로 자신이 가장 잘 알고있는 정보와 방법을 이용해 문제를 해결하고 메시지에 응답한다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="책임-주도-설계-rdd---responsibility-driven-design">책임 주도 설계 (RDD - Responsibility driven design)<a href="#책임-주도-설계-rdd---responsibility-driven-design" class="hash-link" aria-label="Direct link to 책임 주도 설계 (RDD - Responsibility driven design)" title="Direct link to 책임 주도 설계 (RDD - Responsibility driven design)">​</a></h3><p>어떤 책임을 선택하느냐가 전체적인 설계의 방향과 흐름을 결정한다. 먼저 책임을 먼저 찾고 책임을 수행할 적절한 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방식이다.  </p><ul><li>시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다. </li><li>시스템 책임을 더 작은 책임으로 분할한다.</li><li>분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다. </li><li>객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다. </li><li>해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다. </li></ul><p>책임을 할당할 때에 고려해야 하는 두가지</p><ul><li>메시지가 객체를 결정한다. </li><li>행동이 상태를 결정한다. </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="메시지가-객체를-결정한다">메시지가 객체를 결정한다.<a href="#메시지가-객체를-결정한다" class="hash-link" aria-label="Direct link to 메시지가 객체를 결정한다." title="Direct link to 메시지가 객체를 결정한다.">​</a></h3><p>메시지가 객체를 선택헤야하는 두 가지 중요한 이유.</p><ul><li>객체가 최소한의 인터페이스를 가질 수 있게 된다.<br>필요한 메시지가 식별될 때까지 퍼블릭 인터페이스에 어떤 것도 추가하지 않기 때문에 필요한 크기의 인터페이스를 갖게 된다.</li><li>객체는 충분히 추상적인 인터페이스를 가질 수 있게 된다.<br>메시지는 외부의 객체가 요청하는 무언가를 의미하기 때문에 메시지를 먼저 식별하면 무엇을 수행할지에 초점을 맞추는 인터페이스를 얻을 수 있다. </li></ul><p>협력을 구성하는 객체들의 인터페이스는 충분히 추상적인 동시에 최소한의 크기를 유지할 수 있다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="행동이-상태를-결정한다">행동이 상태를 결정한다.<a href="#행동이-상태를-결정한다" class="hash-link" aria-label="Direct link to 행동이 상태를 결정한다." title="Direct link to 행동이 상태를 결정한다.">​</a></h3><p>객체의 행동은 협력에 참여할 수 있는 유일한 방법이다. 객체가 협력에 적합한지를 결정하는 것은 객체의 상태가 아닌 행동이다.  </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-driven-design-데이터-주도-설계">Data-Driven Design (데이터 주도 설계)<a href="#data-driven-design-데이터-주도-설계" class="hash-link" aria-label="Direct link to Data-Driven Design (데이터 주도 설계)" title="Direct link to Data-Driven Design (데이터 주도 설계)">​</a></h4><p>객체의 내부 구현에 초점을 맞춘 설계 방법으로 책임 주도 설계와는 반대로 객체 내부의 상태를 우선 생각하고 인터페이스를 구성하는 방법이다.<br>
<!-- -->DDD의 문제는 내부 구현이 퍼블릭 인터페이스로 노출된다는 것에 있다. 객체 내부의 상태를 컨트롤하기 위해 getter, setter가 퍼블릭 인터페이스로 노출이되어 결국 캡슐화를 저해한다. </p><p>캡슐화를 위반하지 않도록 구현에 대한 결정을 뒤로 미루면서 객체의 행위를 고려하기 위해서는 항상 협력이라는 문맥 안에서 객체를 생성해야 한다.<br>
<!-- -->상태는 단지 객체가 행동을 정상적으로 수행하기 위해 필요한 재료일 뿐이다.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="역할">역할<a href="#역할" class="hash-link" aria-label="Direct link to 역할" title="Direct link to 역할">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="역할과-협력">역할과 협력<a href="#역할과-협력" class="hash-link" aria-label="Direct link to 역할과 협력" title="Direct link to 역할과 협력">​</a></h3><p>객체가 어떤 특정한 협력 안에서 수행해야할 책임의 집합을 역할이라 한다. 협력을 모델링 할때는 특정한 객체가 아니라 역할에게 책임을 할당한다 생각하는게 좋다.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="유연하고-재사용-가능한-협력">유연하고 재사용 가능한 협력<a href="#유연하고-재사용-가능한-협력" class="hash-link" aria-label="Direct link to 유연하고 재사용 가능한 협력" title="Direct link to 유연하고 재사용 가능한 협력">​</a></h3><p>역할이 중요한 이유는 역할을 통해 유연하고 재사용 가능한 협력을 얻을 수 있기 때문이다. 객체가 아닌 책임에 초점을 맞추면 만들어야할 객체의 추상화된 개념을 알 수 있다.<br>
<!-- -->이를 통해 설계단계에서 효과적으로 중복을 제거할 수 있다. 역할은 동일한 역할을 하게 될 다른 객체를 포괄하는 추상화라는 점을 주목해야한다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="객체-대-역할">객체 대 역할<a href="#객체-대-역할" class="hash-link" aria-label="Direct link to 객체 대 역할" title="Direct link to 객체 대 역할">​</a></h3><p>역할은 객체가 참여할 수 있는 일종의 슬롯이다. 협력에 오직 한 가지의 객체만 참여한다면 역할을 고려해야 할까? </p><blockquote><p>협력에 참여하는 후보가 여러 종류의 객체에 의해 수행 될 필요가 있다면 그 후보는 역할이 되지만, 단지 한 종류의 객체만이 협력에 참여할 필요가 있다면 후보는 객체가 된다.<br>
<!-- -->-- 레베카 워프스브록 --</p></blockquote><p>즉 협력에 적합한 대상이 한 종류라면 간단히 개게로 간주하고, 대상이 여러 종류라면 역할로 간주하면 된다. </p><blockquote><p>협력은 역할들의 상호작용으로 구성되고, 협력을 구성하기 위해 역할에 적합한 객체가 선택되며, 객체는 클래스를 이용해 구현되고 생성된다. -- 트리그비 린스카우<br>
<!-- -->협력(Collaboration)  -- referene --&gt; 역할(Role) -- select from --&gt; 객체(Object) -- instance of --&gt; 클래스(Class)</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="역할과-추상화">역할과 추상화<a href="#역할과-추상화" class="hash-link" aria-label="Direct link to 역할과 추상화" title="Direct link to 역할과 추상화">​</a></h3><p>추상화는 세부 사항에 억눌리지 않고도 상위 수준의 정책을 쉽고 간단하게 표현할 수 있다. 불필요한 세부 사항을 생략하고 핵심적인 개념을 강조할 수 있다.<br>
<!-- -->협력이라는 관점에서는 세부적인 사항을 무시하고 추상화에 집중하는 것이 유리하다. </p><p>또한 추상화는 설계를 유연하게 만들수 있다. 역할을 다양한 종류의 객체가 놓일 수 있는 슬롯이라 생각할 수 있다. 컴파일 타임과 런타임의 의존성을 다르게 할 수 있다.
협력안에서 동일한 책임의 다른 객체는 서로 대체될수 있다. 역할은 다양한 환경에서 다양한 객체들을 수용할 수 있게 해주므로 협력을 유연하게 만든다.</p>]]></content:encoded>
            <category>Object</category>
            <category>Book Study</category>
            <category>OOP</category>
        </item>
        <item>
            <title><![CDATA[[오브젝트] Chapter02. 객체지향 프로그래밍.]]></title>
            <link>https://rhdtl78.github.io/dev-blog/object/chapter/02</link>
            <guid>https://rhdtl78.github.io/dev-blog/object/chapter/02</guid>
            <pubDate>Mon, 11 Jan 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[객체지향 프로그래밍]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="요구사항-확인">요구사항 확인<a href="#요구사항-확인" class="hash-link" aria-label="Direct link to 요구사항 확인" title="Direct link to 요구사항 확인">​</a></h2><p>모든 설계가 그러하듯 요구사항을 확인하는 것이 우선이다. 요구사항 분석을 통해 필요한 객체를 정할 수 있고, 각 객체의 책임을 어떻게 분배할지 방향을 잡을 수 있다.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="협력-객체-클래스">협력, 객체, 클래스<a href="#협력-객체-클래스" class="hash-link" aria-label="Direct link to 협력, 객체, 클래스" title="Direct link to 협력, 객체, 클래스">​</a></h2><p>보통 프로그래밍을 어떻게 하는지 생각해보자. 객체지향으로 프로그래밍을 한다고 했을때 가장 먼저 하는것이 무엇인가?  대부분 어떤 <strong>class</strong> 가 필요할 지 고민한다.<br>
<!-- -->클래스를 먼저 고민하고, 각 클래스는 어떤 속성과 메서드를 가지고 있어야 할 지를 생각한다.   </p><p>객체지향 프로그래밍을 위해서는 우선 클래스가 아닌 <strong>객체</strong> 에 초점을 맞춰야 한다.  </p><ol><li>어떤 클래스가 필요한 지가 아닌, 어떤 객체가 필요한지를 생각한다.<br>클래스는 공통적인 상태와 행동을 공유하는 객체를 추상화 한것이다. 추상화를 하기 위한 개념을 먼저 정리해야한다.</li><li>객체를 독립적인 존재가 아니라 기능을 구현하기위해 협력하는 공동체의 구성원으로 봐야한다.<br>객체는 혼자서 할 수 있는 일은 거의 없다. 다른 객체와 상호작용하며 서로 협력하는 존재이며 살아 움직이는 생명체로서 봐야한다. </li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="도메인의-구조를-따르는-프로그램-구조">도메인의 구조를 따르는 프로그램 구조<a href="#도메인의-구조를-따르는-프로그램-구조" class="hash-link" aria-label="Direct link to 도메인의 구조를 따르는 프로그램 구조" title="Direct link to 도메인의 구조를 따르는 프로그램 구조">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="도메인">도메인?<a href="#도메인" class="hash-link" aria-label="Direct link to 도메인?" title="Direct link to 도메인?">​</a></h3><p>도메인이란 문제를 해결하기 위해 사용자가 프로그램을 사용하는 분야라 할수 있다. 영화 예매 시스템을 예로 들면, 영화를 좀 더 쉽고 빠르게 예매하려는 사용자의 문제를 해결 하는 것이다.<br>
<!-- -->여기서 도메인은 영화 예매라 할 수 있다. 도메인은 이처럼 문제를 다루는 범위로 볼 수 있으며 더 작은 단위로도 생각해 볼 수 있다. </p><p>자바와 같은 객체지향 언어를 사용하면 이런 도메인이 class로 이어진다는 것을 쉽게 볼 수 있다. 클래스의 이름은 도메인을 쉽게 유추할 수 있는 이름으로 해야 하고 클래스 간의 관계 또한 도메인의 관계가 반영되어야 한다.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="클래스-구현">클래스 구현<a href="#클래스-구현" class="hash-link" aria-label="Direct link to 클래스 구현" title="Direct link to 클래스 구현">​</a></h2><p>도메인의 정의 다음으로 해야할 일은 도메인을 반영하는 클래스를 구현하는 것이다. 이때, 클래스 외부와 내부의 경계를 구분지어 명확한 경계를 세워야한다. 클래스를 구현하거나 다른 개발자에 의해 개발된 클래슬ㄹ 사용할 때 가장 중요한 것은 클래스의 경계를 구분짓는 것이다.<br>
<!-- -->이 경계가 명확할 수록 객체의 자율성이 보장된다 (chapter 01 참고). 또한 프로그래머에게 구현의 자유를 제공하기 때문에 경계를 명확히 해야 한다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="자율적인-객체">자율적인 객체<a href="#자율적인-객체" class="hash-link" aria-label="Direct link to 자율적인 객체" title="Direct link to 자율적인 객체">​</a></h3><p>객체에 대해 명심해야할 두 가지 사실이 있다. </p><ol><li>객체는 상태 (state)와 행동 (behavior)ㅇㅇ 함께 가지는 복합적인 존재이다. </li><li>객체는 스스로 판단하고 행동하는 자율적인 존재이다.</li></ol><p>객체 지향 개념은 객체라는 단위 안에 데이터와 기능을 한 덩어리로 묶음으로서 문제 영역의 아이디어를 적절하게 표현할 수 있게한다 (캡슐화).
객체 내부에 대한 접근을 통제하는 이유는 객체를 자율적인 존재로 만들기 위해서이다. 객체 외부의 그 무엇도 객체 내부의 상태에 직접 간섭해서는 안되며 객체가 어떤 생각을 하는지도 알아선 안된다.</p><p>객체의 캡슐화와 접근제어는 2가지로 나뉜다.</p><ol><li>public interface (퍼블릭 인터페이스)
외부에서 접근 가능한 부분이며 메시지 교환을 위해 외부에 노출하는 부분이다.</li><li>implementation (구현)
외부에서는 접근 불가능하고 오직 내부에서만 접근 가능한 부분이다. </li></ol><p>이는 인터페이스와 구현의 분리 원칙으로 훌륭한 객체지향 프로그램의 원칙 중 하나이다. 일반적으로 객체의 상탠ㄴ 숨기고 행동만 외부에 공개해야 한다. 속성은 private로 감추고 메서드는 public으로 공개하는 식이다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="프로그래머의-자유">프로그래머의 자유<a href="#프로그래머의-자유" class="hash-link" aria-label="Direct link to 프로그래머의 자유" title="Direct link to 프로그래머의 자유">​</a></h3><blockquote><p>프로그래머의 역할을 클래스 작성자와 클라이언트 프로그래머로 구분하는 것이 유용하다 <!-- -->[Eckel06]<!-- -->.</p></blockquote><p>클래스 작성자는 새로운 데이터 타입을 추가하고, 클라이언트 프로그래머는 클래스 작성자가 추가한 데이터 타입을 사용한다.<br>
<!-- -->클래스 작성자는 클라이언트 프로그래머가 접근하면 안되는 곳을 접근 제한을 통해 구현 은닉(implementation hiding)을 통해 제한한다. 이를 통해 클래스 작성자는 클라이언트 프로그래머에게 미칠 영향으로부터 자유롭게 내부 구현을 변경할 수 있다.<br>
<!-- -->이 구현 은닉은 양쪽에게 이로운 개념이다. 클라이언트 프그래머는 내부 구현은 무시한 채 공개 인터페이스만 알고 있으면 된다. 클래스 작성자는 외부에 미칠 영향을 걱정하지 않고 변경을 할 수 있다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="협력하는-객체들의-공동체">협력하는 객체들의 공동체<a href="#협력하는-객체들의-공동체" class="hash-link" aria-label="Direct link to 협력하는 객체들의 공동체" title="Direct link to 협력하는 객체들의 공동체">​</a></h2><p>앞서 말했듯 객체들은 서로 협력하며 존재한다. 객체는 다른 객체의 인터페잇에 공개된 행동을 수행하도록 요청할 수 있다. 요청을 받은 객체는 자율적인 방법에 따라 요청을 처리한 후 응답한다.<br>
<!-- -->객체가 받은 요청을 처리하기 위한 방법을 메서드라고 한다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="추상화---상속과-다형성">추상화 - 상속과 다형성<a href="#추상화---상속과-다형성" class="hash-link" aria-label="Direct link to 추상화 - 상속과 다형성" title="Direct link to 추상화 - 상속과 다형성">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="컴파일-시간-의존성과-실행시간-의존성">컴파일 시간 의존성과 실행시간 의존성<a href="#컴파일-시간-의존성과-실행시간-의존성" class="hash-link" aria-label="Direct link to 컴파일 시간 의존성과 실행시간 의존성" title="Direct link to 컴파일 시간 의존성과 실행시간 의존성">​</a></h3><p>코드의 의존성과 실행 시점의 의존성이 서로 다를 수 있다. 유연하고 쉽게 재사용 할 수 있으며 확장 가능한 설계가 된다.<br>
<!-- -->그러나 이렇게 유연해 질 수록 복잡도는 높아진다. 실행시점과 컴파일 시점의 의존성이 달라지면 코드를 이해하기 어려워진다. (Trade off :: 유연성, 재사용성 vs 유지보수)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="차이에-의한-프로그래밍">차이에 의한 프로그래밍<a href="#차이에-의한-프로그래밍" class="hash-link" aria-label="Direct link to 차이에 의한 프로그래밍" title="Direct link to 차이에 의한 프로그래밍">​</a></h3><p>상속은 코드를 재사용하기 위해 가장 널리 사용되는 방법이다. 부모의 코드를 그대로 자식에게 물려줄 수 있으며 자식은 부모와 다른 부분만을 구현하면 쉽게 확장할 수 있다. 이런 방식을 차이에 의한 프로그래밍이라 한다.</p><p>상속이 가치있는 이유는 부모의 변수를 재활용하기 때문이라기 보다는 부모가 가진 모든 인터페이스를 자식 클래스가 물려 받을 수 있기 때문이다. 인터페이스는 객체가 이해할 수 있는 메시지의 목록을 정의하는 것임을 생각하면 알수 있다.<br>
<!-- -->실제로 객체간의 관계에서 중요한 것은 어떤 인스턴스인지가 아니라 어떤 메시지를 수신할 수 있느냐가 중요한 것이다. </p><p>런타임에서 자식은 부모의 모든 메시지를 수신 할 수 있기에 부모 클래스와 같은 타입으로 취급하기도 한다. 이를 업캐스팅이라 하는데 자식 클래스가 부모의 타입으로 자동 형변환이 되는 것을 말한다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="다형성">다형성<a href="#다형성" class="hash-link" aria-label="Direct link to 다형성" title="Direct link to 다형성">​</a></h3><p>메서드와 메시지는 다른 개념임을 상기하자. 객체가 메시지를 수신하면 어떤 메서드를 실행할 지는 그 객체와 연결된 클래스가 무엇인가에 따라 달라진다.<br>
<!-- -->다시 말해 동일한 메시지에 대해 어떤 메서드가 실행될 것인지는 메시지를 수신하는 객체의 클래스가 무엇이냐에 따라 달라진다. 이를 다형성이라 부른다.</p><p>학부 과정을 이수했다면 들어봤을 동적바인딩, 정적바인딩이 여기서 사용된다. 다형성을 구현하는 방식은 다양하지만 메시지와 메서드를 실행 시점에 연결한다는 것은 동일하다.<br>
<!-- -->이때 컴파일 타임에 연결하게되면 정적 바인딩, 실행 시점에 연결하는 것을 동적 바인딩이라 한다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="인터페이스와-다형성">인터페이스와 다형성<a href="#인터페이스와-다형성" class="hash-link" aria-label="Direct link to 인터페이스와 다형성" title="Direct link to 인터페이스와 다형성">​</a></h3><p>자바 프로그래머에게 친숙한 인터페이스는 이러한 다형성을 위해 제공된 프로그래밍 요소이다. 클래스의 구현은 필요없고 순수하게 인터페이스 만을 공유하고 싶을때 사용한다.
기본적으로는 Abstract Base Class로 인터페이스를 정의할 수 있다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="추상화와-유연성">추상화와 유연성<a href="#추상화와-유연성" class="hash-link" aria-label="Direct link to 추상화와 유연성" title="Direct link to 추상화와 유연성">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="추상화의-힘">추상화의 힘<a href="#추상화의-힘" class="hash-link" aria-label="Direct link to 추상화의 힘" title="Direct link to 추상화의 힘">​</a></h3><p>추상화는 크게 2가지의 장점을 갖고있다. </p><ol><li>추상화 계층만 보면 요구 사항에 대해 높은 수준에서 서술할 수 있다.<br>세부적인 정책을 무시한 채 상위 정책을 쉽고 간단하게 표현할 수 있다. 이는 다른 요소를 배제하고 상위 개념만으로 도메인의 중요 개념을 설명할 수 있게 해준다. </li><li>추상화를 이용하면 설계가 유연해진다.<br>상위 정책을 추상화를 통해 표현하면 구조를 수정핮지 않고 새로운 기능을 쉽게 추가하고 확장할 수 있다. </li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="유연한-설계">유연한 설계<a href="#유연한-설계" class="hash-link" aria-label="Direct link to 유연한 설계" title="Direct link to 유연한 설계">​</a></h3><p>추상화가 유연한 설계를 가능하게 하는 이유는 설계가 구체적인 상황에 결합되는 것을 방지하기 때문이다. 세부 정책을 구현한 클래스가 추상화된 상위 정책을 상속받고 있다면 어떤 클래스와도 협력 가능하다.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="추상-클래스와-인터페이스-트레이드-오프">추상 클래스와 인터페이스 트레이드 오프<a href="#추상-클래스와-인터페이스-트레이드-오프" class="hash-link" aria-label="Direct link to 추상 클래스와 인터페이스 트레이드 오프" title="Direct link to 추상 클래스와 인터페이스 트레이드 오프">​</a></h3><p>구현과 관련된 모든 것들은 트레이드 오프의 대상이 될 수 있다. 코드의 작성에 있어 이유가 없는 코드는 없어야 한다. 사소한 결정이라도 심사숙고한 끝에 나온 코드와 그렇지 않은 코드는 품질에서 큰 차이가 있다.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="코드-재사용">코드 재사용<a href="#코드-재사용" class="hash-link" aria-label="Direct link to 코드 재사용" title="Direct link to 코드 재사용">​</a></h3><p>상속은 일반적으로 코드를 재사용하는데 널리 쓰이는 방법이다. 그러나 널리 사용된다고 해서 베스트는 아니다. 합성(composition)도 들어 보았을 것이다. 사용하고자 하는 코드를 담고있는 인스턴스를 변수로 포함해 사용하는 방식이다.<br>
<!-- -->많은 컨텍스트나 프레임워크들이 합성을 선호하는 모습을 보인다., Spring framework애서도 대부분의 의존성을 합성 관계로 사용하는 것을 볼 수 있다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="상속">상속<a href="#상속" class="hash-link" aria-label="Direct link to 상속" title="Direct link to 상속">​</a></h3><p>왜 상속 대신 합성을 선호할까? 상속의 문제점은 캡슐화를 위반한다는 것과 설계를 유현하지 않게 한다는 것이다.<br>
<!-- -->가장 큰 문제는 캡슐화를 위반한다는 것이다. 상속을 하기 위한 기본 전제는 부모 클래스를 잘 알고있어야 한다는 것이다. 부모 내부의 다른 메서드가 내부의 어떤 추상 메서드를 호출하고 있다는 것을 알고 이를 구현해야 한다.<br>
<!-- -->결과적으로 자식에게 부모의 구현이 고스란히 노출되기 때문에 캡슐화가 약화된다. 부모가 변경된 경우 자식도 변경될 확률을 높인다.</p><p>설계가 유연하지 않게 되는 것은 부모와 자식의 관계가 강하게 결합되기 때문이다. 부모와 자식의 관계는 컴파일 시점에 결정되기 때문에 실행 시점에 객체의 종류를 변경할 수 없게된다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="합성">합성<a href="#합성" class="hash-link" aria-label="Direct link to 합성" title="Direct link to 합성">​</a></h3><p>앞서 말했듯 합성은 인스턴스를 내부에 포함하는 방법으로, 객체의 인스턴스를 통해서만 코드를 재사용할 수 있다. 합성은 상속이 가지는 두가지 문제점을 모두 해결한다.<br>
<!-- -->인터페이스에 정의된 메시지만을 사용하기 때문에 구현을 효과적으로 캡슐화할 수 있다. 또한 의존하는 클래스를 교체하기 쉽기 때문에 설계를 유연하게 만든다.
따라서 코드 재사용을 위해서는 상속 보다는 합성을 선호하는 것이 더 좋은 방법이다. </p><p>그러나 합성만을 사용하는 것은 좋은 방법이 아니다. 대부분의 설계는 상속과 합성을 함께 사용해야 한다. 다형성을 위해 인터페이스를 재사용하는 경우에는 상속과 합성을 함께 조합해서 사용할 수밖에 없다.</p>]]></content:encoded>
            <category>Object</category>
            <category>Book Study</category>
            <category>OOP</category>
        </item>
        <item>
            <title><![CDATA[[오브젝트] Chapter01. 객체, 설계.]]></title>
            <link>https://rhdtl78.github.io/dev-blog/object/chapter/01</link>
            <guid>https://rhdtl78.github.io/dev-blog/object/chapter/01</guid>
            <pubDate>Sat, 09 Jan 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[객체? 설계?]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="응집도와-캡슐화-encapsulation">응집도와 캡슐화 (Encapsulation)<a href="#응집도와-캡슐화-encapsulation" class="hash-link" aria-label="Direct link to 응집도와 캡슐화 (Encapsulation)" title="Direct link to 응집도와 캡슐화 (Encapsulation)">​</a></h2><p>객체 내부의 상태를 캡슐화하고 객체 간에는 오직 메시지를 통해서만 상호작용하도록 만드는 것을 캡슐화(Encapsulation)이라 한다.<br>
<!-- -->자신 이외의 객체는 내부의 상태, 구현등을 알 수 없어야 한다.  </p><p>어느 한 객체가 다른 객체의 내부를 속속들이 알 수 있을 때, 결함도가 높다 할 수 있다. 결합도가 높을 수록 변경이 발생할 때 그 범위가 커진다.<br>
<!-- -->알고있는 것이 많을 수록 건드려야 할 부분이 많아진다. </p><p>반대로 객체가 적절히 캡슐화되어 자신이 해야할 일만 하게 되어 자율적인 객체가 될 수록 응집도가 높아지고, 결합도가 낮아진다 할 수 있다.<br>
<!-- -->결합도가 낮을 수록, 응집도가 높을 수록 변경에 유연해진다. 유지 보수에 필요한 수고가 줄어들게 된다.</p><p>객체는 자신의 데이터를 스스로 처리하는 자율적인 존재여야한다.외부의 간섭을 ㅊ최대한 배체하고 메시지를 통해서만 협력하는 자율적인 객체들의 공동체를 만드는 것이 객체지향 설계이다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="절차지향과-객체지향">절차지향과 객체지향<a href="#절차지향과-객체지향" class="hash-link" aria-label="Direct link to 절차지향과 객체지향" title="Direct link to 절차지향과 객체지향">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="절차적-프로그래밍">절차적 프로그래밍?<a href="#절차적-프로그래밍" class="hash-link" aria-label="Direct link to 절차적 프로그래밍?" title="Direct link to 절차적 프로그래밍?">​</a></h3><p>하나의 기능에 여러 다른 데이터를 알고, 사용하는 방식의 프로그래밍을 절차적이라 할 수 있다.<br>
<!-- -->프로세스와 데이터를 각기 다른 모듈로 위치하고, 프로세스에서 데이터를 다루는 방식을 절차적 프로그래밍이라 할 수 있다.<br>
<!-- -->이 경우, 어느 한 곳에서 변경이 발생하면, 해당 프로세스에 참여한 다른 구성원에도 변경이 필요할 수 있다. 즉, 변경에 유연하지 않다.</p><p>이 경우, 절차를 말로 서술해보면 직관에 맞지 않게 된다.<br>
<!-- -->저자는 이에 소극장을 예로 들며 설명한다.</p><blockquote><p>소극장은 관람객의 가방을 열어 그 안에 초대장이 들어있는지 살펴본다. 가방 안에 초대장이 들어 있으면 판매원은 매표소에 보관 돼있는 티켓을 관람객의 가방 안으로 옮긴다.<br>
<!-- -->가방 안에 초대장이 들어있지 않다면 관람객의 가방에서 티켓 금액만큼의 현금을 꺼내 매표소에 적립한 후에 매표소에 보관돼 있는 티켓을 관람객의 가방 안으로 옮긴다.</p></blockquote><p>절차지향 프로그래밍은 우리의 일반적인 관념과 일치하지 않는 모습을 보인다. 이는 데이터에 해당하는 구성원들은 모두 수동적인 존재로 취금되었기 때문이다.<br>
<!-- -->프로세스가 모든 데이터에 접근해 변화를 일으키고, 모든 변화를 관리하기 때문에 직관과 다른 작업 흐름이 발생한 것이다.<br>
<!-- -->또한 위 예로도 결합도가 아주 높다는 것을 알 수 있을 것이다. 소극장은 관람객, 가방, 티켓, 판매원 모두에게 의존하고있다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="객체지향-프로그래밍">객체지향 프로그래밍?<a href="#객체지향-프로그래밍" class="hash-link" aria-label="Direct link to 객체지향 프로그래밍?" title="Direct link to 객체지향 프로그래밍?">​</a></h3><p>위의 절차적 프로그래밍의 단점을 해결하기 위해선, 각 구성원이 자신의 데이터를 스스로 처리하도록 프로세스의 적절한 단계를 각 구성원의 내부로 옮기는 것이다.
위 서술에서 첫 부분을 바꿔보면 아래와 같을 것이다.</p><blockquote><p>소극장은 관람객의 가방을 열어 그 안에 초대장이 들어있는지 살펴본다. -&gt; 판매원은 관람객에게 초대장이 있는지 확인을 요청한다. 관람객은 자신의 가방을 열어 초대장이 있는지 확인해 판매원에게 알려준다.</p></blockquote><p>위 변화는 우리가 일반적으로 생각할 수 있는 구성원의 행동이다. 객체지향 프로그래밍을 생각할 때 이렇게 우리가 생각할 수있는 행동을 서술해보면 알기 쉽게 어디가 문제인지 알수 있다.<br>
<!-- -->만약 관람객이 초대장을 확인하기위해 지갑을 확인해야 한다 가정하면 절차적 프로그래밍의 예에서는 관람객은 물론 소극장에도 변화가 필요하게 된다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="책임의-이동">책임의 이동<a href="#책임의-이동" class="hash-link" aria-label="Direct link to 책임의 이동" title="Direct link to 책임의 이동">​</a></h2><p>절차적 프로그래밍과 객체지향 프로그래밍의 근본적인 차이를 만드는 것은 <strong>"책임의 이동"</strong> 이다. 여기서 책임은 기능이라 할수 있다.<br>
<!-- -->위 절차적 프로그래밍의 예시는 <strong>소극장에게 책임이 집중되어있다.</strong> 반면 객체지향 프로그래밍의 예시 서술은 한소절 뿐이지만 이미 소극장은 보이지 않고, 같은 일을 위한 단계가 적절히 나눠져있음을 알수 있다.  </p><p>객체 지향에서는 독재자는 존재하지 않는다. 구성원 모두에게 적절한 책임이 있고, 각 구성원은 각자의 책임을 벗어나는 행위를 하지 않는다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="설계가-왜-필요한가">설계가 왜 필요한가?<a href="#설계가-왜-필요한가" class="hash-link" aria-label="Direct link to 설계가 왜 필요한가?" title="Direct link to 설계가 왜 필요한가?">​</a></h2><p>책에서는 설계를 다음과같이 인용하고있다</p><blockquote><p>설계란 코드를 배치하는 것이다 <!-- -->[Metz12]</p></blockquote><p>한창 학과 공부를 할때는 설계가 굉장히 귀찮고, 힘든 일이며 구현하는 것보다 더 어려운 것으로 여겼다.<br>
<!-- -->그러나 실무를 해보며 느낀 바로는 전혀 그렇지 않았다. 설계와 구현은 함께 가야하는 것이며, 코드를 작성하는 매 순간이 설계이며 설계는 코드 없이는 검증할 수 없다.  </p><p>좋은 설계란 무엇인가? 오늘 완성해야 하는 기능을 구현하는 코드를 작성하는 동시에 내일 쉽게 변경할 수 있는 코드를 작성할수있는 설계이다.<br>
<!-- -->변경을 수용할수 없는 설계는 이후에 비싼 대가를 치루며 더 어려운 코드를 만들거나, 새로만들게 된다. 최소한의 수정으로 원하는 변경을 충족해야한다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="객체지향-설계">객체지향 설계<a href="#객체지향-설계" class="hash-link" aria-label="Direct link to 객체지향 설계" title="Direct link to 객체지향 설계">​</a></h2><p>객체지향 설계는 우리가 세상을 보는 관념대로 코드를 작성할 수 있게 돕는다. 객체는 서로를 의존하며 메시지를 주고받으며 기능을 구성한다.<br>
<!-- -->훌륭한 객체지향 설계는 객체 사이의 의존성을 적절하게 관리하는 설계이다. 객체간의 의존성은 프로그램의 변경을 어렵게하는 주범이다. </p><hr>]]></content:encoded>
            <category>Object</category>
            <category>Book Study</category>
            <category>OOP</category>
        </item>
        <item>
            <title><![CDATA[[Kafka] Chapter01. 카프카란 무엇인가.]]></title>
            <link>https://rhdtl78.github.io/dev-blog/kafka/chapter/01</link>
            <guid>https://rhdtl78.github.io/dev-blog/kafka/chapter/01</guid>
            <pubDate>Fri, 14 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Apache kafka - 카프카, 데이터 플랫폼의 최강자 스터디 - chapter 1]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="개요">개요<a href="#개요" class="hash-link" aria-label="Direct link to 개요" title="Direct link to 개요">​</a></h2><p>이번 장에서 카프카란 무엇인가, 동작 방식과 특징에 대해 알아볼 것이다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="배경">배경<a href="#배경" class="hash-link" aria-label="Direct link to 배경" title="Direct link to 배경">​</a></h2><p>카프카는 Linkedin에서 처음 출발한 기술로, 사이트의 급속헌 발전으로 인해 발생하는 여러 내부 이슈를 해결하기 위해 개발된 플랫폼이다. 서비스의 확장에 따라 그 구조도 따라 변화해야 하지만, 언젠가 그 변화의 한계가 올 것이고, 그 한계를 극복해야 더욱 견고하고, 안정적인 서비스를 운영 할 수 있다.
카프카는 확장성과 고 가용성, 정확성을 고려한 데이터 플랫폼으로 서비스를 구성하고있는 요소와 느슨한 결합을 유지한 채 확정성을 보장한다. 이런 카프카의 동작 원리와 특징을 이번 장에서 학습하고자 한다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="동작-방식과-원리">동작 방식과 원리<a href="#동작-방식과-원리" class="hash-link" aria-label="Direct link to 동작 방식과 원리" title="Direct link to 동작 방식과 원리">​</a></h2><p>카프카는 기본적으로 메시징 서버로 동작한다. 메세지를 발생하는 측(Producer, Publisher)과 그 메세지를 사용하는 측(Consumer, Subscriber), 그리고 이 메세지를 구분할 수 있는 토픽으로 해당 정보를 교환하는 통신 구조를 Pub/Sub 구조라 한다. 이런 통신 구조는 중앙에 교환기가 필요한데, 카프카는 그 역할을 하는 서버이다. 여기서 카프카는 일반적인 Pub/Sub 구조와는 달리, 메세지 교환 전달의 신뢰성 관리를 프로듀서와 컨슈머로 넘기고, 부하가 많이 걸리는 교환기의 기능을 컨슈머가 만들 수 있게 해서 메세지 전달에 성능을 집중시킨 고성능 메시징 시스템을 만들었다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="동작-흐름">동작 흐름<a href="#동작-흐름" class="hash-link" aria-label="Direct link to 동작 흐름" title="Direct link to 동작 흐름">​</a></h3><p>동작의 흐름은 다음과 같다.</p><ol><li>프로듀서는 카프카로 메세지를 보낸다. </li><li>프로듀서가 보낸 메세지는 카프카에 컨슈머 큐에 저장된다.</li><li>컨슈머는 카프카 서버에 접속해 새로운 메세지를 가져간다.</li></ol><p>카프카는 기존의 메시징 서비스와 동일하게 비동기 시스템이다. 프로듀서는 컨슈머와 별도의 관계를 맺지 않고 메세지를 전송할 수 있으며, 컨슈머는 프로듀서와 관계 없이 자신이 관심있는 메세지를 읽어올 수 있다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="멀티-프로듀서-멀티-컨슈머">멀티 프로듀서, 멀티 컨슈머<a href="#멀티-프로듀서-멀티-컨슈머" class="hash-link" aria-label="Direct link to 멀티 프로듀서, 멀티 컨슈머" title="Direct link to 멀티 프로듀서, 멀티 컨슈머">​</a></h3><p>카프카 내에서 메세지는 토픽이라는 단위로 구분된다. 컨슈머는 이 토픽으로 자신의 메세지를 구별해 가져올 수 있고, 프로듀서는 토픽에 메세지를 보내놓으면 된다. 이 토픽은 일대일 구조 뿐만 아니라 다대다 구조로 사용할 수 있다. 하나의 토픽에 여러 프로듀서가 메세지를 보낼 수 있고, 여러 토픽을 하나의 컨슈머가 구독할 수 있다. 이 덕분에 카프카는 중앙 집중형 구조로 구성할 수 있다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="디스크에-메세지-저장">디스크에 메세지 저장<a href="#디스크에-메세지-저장" class="hash-link" aria-label="Direct link to 디스크에 메세지 저장" title="Direct link to 디스크에 메세지 저장">​</a></h3><p>카프카가 다른 메세징 시스템과 구분되는 가장 큰 특징은 디스크에 메세지가 저장된다는 것이다. 다른 메세징 시스템은 컨슈머가 메세지를 가져가는 동시에 해당 메세지를 큐에서 지우지만, 카프카는 컨슈머가 메세지를 가져가도 지우지 않고 디스크에 남겨둔다. 이 덕분에 트래픽의 일시적 폭주로 인해 처리가 늦어지더라도 컨슈머는 메세지 손실 없이 가져갈 수 있으며, 오류발생으로 컨슈머를 잠시 중단하더라도, 메세지는 남아있으므로 복구시에 데이터의 유실 없이 장애로부터 복구할 수 있다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="확장성">확장성<a href="#확장성" class="hash-link" aria-label="Direct link to 확장성" title="Direct link to 확장성">​</a></h3><p>카프카는 확장이 매우 용이하도록 설계되어있다. 1개의 카프카 클러스터는 기본 3개의 브로커로 시작해 수십개의 브로커로 확장 할 수 있으며 이 확장 작업은 서비스의 중단 없이 이뤄질 수 있다. 최초 서비스 시작시 적은 수의 클러스터로 구성하고, 이후의 필요에 의해 부담없이 클러스터의 수를 확장할 수 있다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="높은-성능">높은 성능<a href="#높은-성능" class="hash-link" aria-label="Direct link to 높은 성능" title="Direct link to 높은 성능">​</a></h3><p>카프카는 매우 높은 성능을 목표로 탄생한 Application이다. 고성능을 유지하기 위해 내부적으로 분산처리, 배치 등 다양한 기법을 사용하고 있다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="마무리">마무리<a href="#마무리" class="hash-link" aria-label="Direct link to 마무리" title="Direct link to 마무리">​</a></h2><p>이번 장에서 카프카의 배경과 동작 방식, 그리고 동작 원리에 대해 학습했다. 실무에서 한번씩은 경험해볼법한 메세지 서비스를 고가용성과 확장성을 고려한 Application으로 만든 카프카를 통해 구성해보면 어떨지 생각해 볼 수 있었다.</p><p>다음 챕터는 카프카가 어떻게 디자인 되어있는지를 학습할 것이다.</p>]]></content:encoded>
            <category>Kafka</category>
            <category>Study</category>
        </item>
        <item>
            <title><![CDATA[[Kafka] Chapter03. 카프카 디자인]]></title>
            <link>https://rhdtl78.github.io/dev-blog/kafka/chapter/03</link>
            <guid>https://rhdtl78.github.io/dev-blog/kafka/chapter/03</guid>
            <pubDate>Fri, 14 Aug 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Apache kafka - 카프카, 데이터 플랫폼의 최강자 스터디 - chapter 3]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="개요">개요<a href="#개요" class="hash-link" aria-label="Direct link to 개요" title="Direct link to 개요">​</a></h2><p>이번 장에서는 카프카가 어떻게 디자인 되어있는지를 학습할 것이다.<br>
<!-- -->카프카 디자인의 특징인 카프카의 분산 시스템과 페이지 캐시, 배치 처리를 알아 보고 카프카의 데이터 모델에서 토픽과 파티션, 오프셋을 이해하며, 카프카의 고가용성과 리플리케이션을 학습할 것이다.<br>
<!-- -->또한 카프카 운영에 도움을 주는 주키퍼의 지노드 역할을 알아보고 학습을 마무리 할 것이다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="카프카-디자인의-특징">카프카 디자인의 특징<a href="#카프카-디자인의-특징" class="hash-link" aria-label="Direct link to 카프카 디자인의 특징" title="Direct link to 카프카 디자인의 특징">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="분산-시스템">분산 시스템<a href="#분산-시스템" class="hash-link" aria-label="Direct link to 분산 시스템" title="Direct link to 분산 시스템">​</a></h3><p>카프카는 기본적으로 분산 처리 기법이 적용되어있다.<br>
<!-- -->서비스의 확장을 위해 물리적으로 서버를 증설하는 경우, 서비스 애플리케이션을 복제해 실행하는 경우에는  비용이 크고 과정이 쉽지 않다.<br>
<!-- -->허나 카프카는 기본적으로 분산 처리 시스템이기 때문에 클러스터의 브로커를 서버 상황에 따라 유동적으로 확장할 수 있다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="페이지-캐시">페이지 캐시<a href="#페이지-캐시" class="hash-link" aria-label="Direct link to 페이지 캐시" title="Direct link to 페이지 캐시">​</a></h3><p>카프카의 처리 기능을 높이기 위한 기능중 하나는 페이지 캐싱을 이용하는 것이다.<br>
<!-- -->OS의 캐시 기법인 페이지 캐싱은 메모리의 남은 영역을 이용해 디스크에 바로 읽고 쓰지 않고 데이터를 읽고 쓰는 기법으로 빠른 데이터의 접근을 위해 카프카는 이런 방식을 사용하고 있다.<br>
<!-- -->이 덕분에 카프카를 운용할 서버의 디스크는 저렴한 SATA 디스크를 사용해도 무리가 없다고 한다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="배치-전송-처리">배치 전송 처리<a href="#배치-전송-처리" class="hash-link" aria-label="Direct link to 배치 전송 처리" title="Direct link to 배치 전송 처리">​</a></h3><p>서버와 클라이언트 사이에 데이터를 주고받으면서 크고 작은 I/O가 발생하는 것은 피할 수 없다. 그러나 작은 I/O가 여러번 발생하게된다면 이는 시스템의 성능 저하로 이어질 것이다.<br>
<!-- -->카프카는 이를 피하기 위해 작은 메시지들을 모아서 한번에 처리할 수 있는 배치 전송 처리를 사용하고 있다. 이 덕분에 네트워크 오버헤드 등을 줄이게 되어 높은 성능을 유지할 수 있다. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="캬프카-데이터-모델">캬프카 데이터 모델<a href="#캬프카-데이터-모델" class="hash-link" aria-label="Direct link to 캬프카 데이터 모델" title="Direct link to 캬프카 데이터 모델">​</a></h2><p>카프카가 고성능 메세징 애플리케이션으로 발전한 데는 토픽 (Topic)과 파티션 (Partition)이라는 데이터 모델의 역할이 크다.<br>
<!-- -->토픽은 메세지를 받을 수 있는 논리적 묶음고, 파티션은 토픽을 구성하는 데이터 저장소로서 수평 확장이 가능한 단위이다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="topic">Topic<a href="#topic" class="hash-link" aria-label="Direct link to Topic" title="Direct link to Topic">​</a></h3><p>카프카가 메시지를 저장하는 공간이다.<br>
<!-- -->기존의 메일 시스템과 비교하면, 토픽은 메일 주소에 해당한다.
프로듀서는 메세지를 보낼때 토픽에만 보내고, 컨슈머는 메시지를 사용할 때 필요한 토픽에서 가져온다.  </p><p>토픽은 249자 미만으로 영문, 숫자, '.,_-'를 조합하여 자유롭게 이름을 지을 수 있다.<br>
<!-- -->토픽의 이름은 이후의 시스템 확장을 고려해, 각자 형식에 맞춰 이름을 구분해두는 것이 좋다.<br>
<!-- -->별도의 규칙은 없지만, 최소한의 접두어로 구분해 두는 것을 추천한다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="partition">Partition<a href="#partition" class="hash-link" aria-label="Direct link to Partition" title="Direct link to Partition">​</a></h3><p>카프카의 파티션이란 토픽을 수평 분할한 것이다.</p><p>토픽에 전송하는 시간이 1초 걸린다고 가정하자.<br>
<!-- -->이 때, 4개의 프로듀서에서 각각 카프카로 1개의 메시지를 보낸다면, 순차적으로 처리하기 때문에 오롯이 4초가 소요된다.
그러나 파티션을 사용한다면 이를 효과적으로 처리할 수 있다.<br>
<!-- -->하나의 토픽을 4개의 파티션으로 분할한다면, 이 토픽을 사용하는 4개의 프로듀서가 동시에 메세지를 보내도, 모두 1초에 처리할 수 있게 된다. </p><p>그러나 여기에 한 가지 제약 사항이 있다.<br>
<!-- -->카프카는 메세징 큐 기반이기 때문에 메세지를 처리하기 위해서는 메세지의 순서가 보장되어야 한다.<br>
<!-- -->이 때문에 앞서 예로 든 1개의 파티션의 경우에서 4초가 소요되는 것이다. </p><p>따라서 카프카의 성능을 효율적으로 활용하기 위해서 토픽의 파티션 수와, 해당 토픽을 사용하는 프로듀서/컨슈머의 수를 같게 하는 것이 좋다.</p><p>여기서 또 고려 사항이 발생한다. 무조건 파티션의 수를 늘려야하나?<br>
<!-- -->결론을 먼저 언급하자면, 그렇지 않다.</p><p>각 파티션은 브로커의 디렉토리와 매핑되고, 데이터 마다 2개의 파일 (인덱스, 실제 데이터)을 저장하게 된다.<br>
<!-- -->카프카는 모든 디렉토리에 대해 파일 핸들러를 열게 되는데, 이 때 파티션의 수가 늘게 되면 그 수 만큼 파일 핸들러 역시 많이지게 되어 리소스를 낭비하게 된다.</p><p>또 카프카는 고가용성을 위해 리플리케이션을 지원한다. 브로커에 존재하는 파티션들에 대해 각각 리플리케이션이 동작하게 되며 이중 하나는 파티션의 리더, 나머지는 팔로워로 동작하게 된다.
이 때, 만약, 리더의 브로커가 다운되게 되면 파티션의 팔로워중 하나가 리더로서 승격되어 동작하게 되는데, 새로운 리더를 선출 하는데 걸리는 시간은 곧 장애 시간으로 환산된다.<br>
<!-- -->최악의 경우, 다운된 브로커가 컨트롤러일 경우, 컨트롤러가 살아있는 다른 브로커에게 완전히 넘어가기 전까지 새로운 리더를 선출 할 수 조차 없다.<br>
<!-- -->파티션의 수가 많다면, 이 페일 오버 (Failover) 동작을 완수하는데 걸리는 시간이 더 길 것이며 장애 시간도 그 만큼 길게 된다. </p><p>따라서 이상적인 파티션의 갯수는 프로듀서/컨슈머 중 가장 많은 수와 동일 한 것이 적절하다고 할수 있다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="offset-message-order">Offset, Message order<a href="#offset-message-order" class="hash-link" aria-label="Direct link to Offset, Message order" title="Direct link to Offset, Message order">​</a></h3><p>카프카에서는 각 파티션 마다 메세지가 저장되는 위치를 오프셋 (Offset) 이라고 부른다.<br>
<!-- -->오프셋은 파티션 내에서 유일하고, 순차적으로 증가하는 64비트 정수로 되어있다. </p><p>프로듀서가 파티션 0에 메세지를 0, 1, 2, 3, 4, 5 로 저장했다면, 컨슈머는 무조건 동일하게 0, 1, 2, 3, 4, 5로 가져갈 수 밖에 없다. 즉, 절대로 메세지 순서가 바뀐 상태로는 가져갈 수 없다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="카프카의-고가용성과-리플리케이션">카프카의 고가용성과 리플리케이션<a href="#카프카의-고가용성과-리플리케이션" class="hash-link" aria-label="Direct link to 카프카의 고가용성과 리플리케이션" title="Direct link to 카프카의 고가용성과 리플리케이션">​</a></h2><p>카프카는 앞서 언급 했듯이 리플리케이션을 지원한다.<br>
<!-- -->물리적 장애가 발생하는 경우에도 고가용성을 보장할 수 있는 이유가 이 때문이다.<br>
<!-- -->토픽 자체를 복제하지 않고, 토픽의 파티션들을 복제한다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="replication-factor-leader-follower">Replication Factor, Leader, Follower<a href="#replication-factor-leader-follower" class="hash-link" aria-label="Direct link to Replication Factor, Leader, Follower" title="Direct link to Replication Factor, Leader, Follower">​</a></h3><ol><li>Replication Factor<br>카프카 설정 파일에 다음과 같은 항목이 있다.<br><code>default.replication.factor</code><br>이 설정은 리플리케이션의 수를 설정하는 것이며 해당 항목이 없다면 기본 값인 <code>default.replication.factor=1</code>이 설정되어있다.<br>아 설정은 아무 옵션 없이 카프카를 실행할 때 적용되는 값으로 변경하려면 설정 파일을의 해당 내용을 변경하거나 옵션을 주어 재시작해야한다.<br>또한, 클러스터 내의 모든 브로커에 동일한 값을 설정해주어야 한다. </li><li>Replication Leader, Follower<br>리플리케이션된 파티션을 부르는 용어는 각 애플리케이션 마다 다르다. 카프카의 주키퍼에선 리더(Leader)와 팔로워(Follower)라고 부른다.<br>모든 읽기, 쓰기 작업은 리더에서 수행된다. 팔로워들은 리더의 데이터를 그대로 리플리케이션만 하고 읽기, 쓰기 작업에는 관여하지 않는다. 따라서 리더와 팔로워는 순서와 오프셋이 동일한 메세지를 갖게된다.
물리적인 공간을 차지하는 크기도 동일하기 때문에 무조건 리플리케이션 팩터를 동일한 값으로 설정하기 보다는, 데이터의 중요도에 따라 다르게 두어 효율적으로 운영하는 것이 좋다.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="management-of-replication-reader-and-follower">Management of Replication Reader and Follower<a href="#management-of-replication-reader-and-follower" class="hash-link" aria-label="Direct link to Management of Replication Reader and Follower" title="Direct link to Management of Replication Reader and Follower">​</a></h3><p>카프카에서 리더와 팔로워는 각자 맡은 역할이 다르다.<br>
<!-- -->리더는 모든 데티어의 읽기 쓰기에 대한 요청에 응답하면서 데이터를 저장해 나가고, 팔로워는 리더를 주기적으로 보면서 자신에게 없는 데이터를 리더로부터 주기적으로 가져오는 방법으로 리플리케이션을 유지한다.
카프카에서는 이 과정에서 정합성을 유지하기 위해 ISR(In Sync Replica)라는 개념을 도입했다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="in-sync-replica-isr">In Sync Replica (ISR)<a href="#in-sync-replica-isr" class="hash-link" aria-label="Direct link to In Sync Replica (ISR)" title="Direct link to In Sync Replica (ISR)">​</a></h3><p>ISR 이란 현재 리플리케이션 되고있는 애플리케이션 그룹이다.<br>
<!-- -->여기에는 중요한 규칙이 하나 있는데 이 규칙은 ISR에 속해 있는 구성원만이 리더의 자격을 가질 수 있다는 것이다. </p><p>ISR 의 동작 과정을 나열하면 다음과 같다.</p><ul><li>가정<br>프로듀서 1개, 3개의 브로커, 1개의 리더, 2개의 팔로워</li><li>동작 과정<ol><li>기본 상태는 ISR이 모든 브로커의 파티션으로 그룹화.</li><li>프로듀서가 메세지 A를 토픽에 전송</li><li>토픽의 리더 파티션이 메세지를 저장, 요청에 응답.</li><li>팔로워 파티션이 리더의 변경을 감지, 동기화.</li><li>ISR이 리더와 동기화 된 파티션을 대상으로 축소됨.</li></ol></li></ul><p>자세히 알아보자.</p><ol><li>프로듀서는 A 라는 메세지를 토픽의 리더에게 전달한다. </li><li>프로듀서가 보낸 메세지 A는 토픽의 리더만이 처리하고, 요청에대한 응답을 전달한다.<br>모든 메세지는 리더만이 읽기 쓰기작업을 수행할 수 있기 때문에 리더 파티션만 데이터를 다룬다. 이후 팔로워 파티션들은 이 리더의 변경을 짧은 주기로 확인하며 동기화를 시도한다.<br>여기서 팔로워 2대중 1대 (편의상 1, 2번이라 하고, 2번에 장애가 발생했다 하자.)가 정상 동작하지 않는다. 리더는 설정된 주기만큼 팔로워들로 부터 확인 요청이 오지 않는다면, 해당 파티션을 정상작동하지 않는다고 판단, ISR에서 제외한다.</li><li>리더 파티션이 팔로워 파티션 2를 ISR 그룹에서 추방해 ISR 그룹이 축소된다. 팔로워 1은 계속해서 리더 파티션에게 변경 확인요청을 보내며 정합성을 유지한다.</li></ol><p>이렇게 리더가 ISR을 관리해 가면서 다음 리더 후보군을 제한할 수 있다. 위 상황에서 만약 리더가 다운된다면, 팔로워1이 다시 리더로 승격하게 되고, 프로듀서와 컨슈머의 요청을 이어서 처리하게 된다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="모든-broker-가-다운된다면">모든 Broker 가 다운된다면?<a href="#모든-broker-가-다운된다면" class="hash-link" aria-label="Direct link to 모든 Broker 가 다운된다면?" title="Direct link to 모든 Broker 가 다운된다면?">​</a></h2><p>위와 같은 상황에서 더 최악의 상황으로 가보자.<br>
<!-- -->위의 3대의 브로커가 모두 다운이 된다면 어떻게 될지 상상해 보자. 이 경우 장애 복구 작업은 2가지 전략이 있을수 있다.   </p><ol><li>마지막 리더가 살아나기를 기다린다. </li><li>ISR에서 추방되었지만, 먼저 살아나면 자동으로 리더가 된다. </li></ol><p>데이터의 정확도에서는 1번이 가장 좋은 시나리오이지만 필수 조건이 요구된다.</p><blockquote><p>재시작시, 마지막 리더가 반드시 시작되어야 한다. </p></blockquote><p>경우에 따라서는 마지막 리더가 재시작 후에도 정상작동하지 못할 수 도 있다. 마지막 리더의 정상화 까지 장애는 유지될 것이다.</p><p>2번의 경우에는 메세지의 손실이 발생한다. ISR에서 추방된 브로커는, 마지막 리더에 있지만, 자신에게는 없는 메세지가 있을 수 있다. 그러나 1과는 다르게 빠른 서비스 정상화가 가능하다. </p><p>2가지 경우중 어느 것이 맞다고 할 수 없다. 카프카에서는 0.11.0 이하 버전에서 기본값으로 2번을 채택해 빠른 서비스 정상화 전략을 사용했으나, 이후의 버전부터는 1번을 채택해 정합성을 유지하는 전략을 사용하고있다.<br>
<!-- -->그러나 사용자의 선택에 따라 관련 설정은 카프카의 설정 파일에서 원하는 옵션으로 변경할 수 있다.<br>
<code>unclean.leader.election.enable</code>항목의 값을 true, false로 지정함에 따라 각각 2번, 1번의 전략을 사용한다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="카프카에서-사용하는-zookeeper-와-z-node-의-역할">카프카에서 사용하는 Zookeeper 와 Z-Node 의 역할<a href="#카프카에서-사용하는-zookeeper-와-z-node-의-역할" class="hash-link" aria-label="Direct link to 카프카에서 사용하는 Zookeeper 와 Z-Node 의 역할" title="Direct link to 카프카에서 사용하는 Zookeeper 와 Z-Node 의 역할">​</a></h2><p>편의상 카프카의 지노드를 /root라 명명한다.</p><ol><li><p><code>/root/controller</code><br>
<!-- -->현재 카프카 클러스터의 컨트롤러 정보를 확인할 수 있다.<br>
<!-- -->리더를 선정하는 프로세스는 매우 종요하며 브로커의 실패 등으로 인해 리더가 변경되면 모든 파티션에 대해 파티션 마다 리더 선출 작업이 필요로하게 된다.<br>
<!-- -->컨트롤러는 브로커 레벨에서 실패를 감지하고 실패한 브로커에 의해 영향을 받는 모든 파티션의 리더 변경을 책임지고 있다.<br>
<!-- -->컨트롤러는 클러스터 내 브로커 중에 임의로 선정되고, 컨트롤러 브로커가 다운될 경우, 남은 브로커중 하나가 새로운 컨트롤러가 된다. </p></li><li><p><code>/root/brokers</code><br>
<!-- -->브로커 관련된 정보들이 저장된다.<br>
<!-- -->설치 시 브로커 설정에서 수정한 <code>broker.id</code>를 확인 할 수 있다.<br>
<!-- -->브로커는 시작시 <code>/root/brokers/ids</code>에 <code>broker.id</code>로 지노드를 생성해 자신을 등록한다.<br>
<!-- -->중복된 id 등록시 오류가 발생한다.</p><p>주키퍼의 임시노드를 사용해 등록하고, 만약 브로커가 종료되거나 다운되면 지노드는 사라진다.<br>
<code>/root/brokers/topics</code>를 확인해보면 클러스터 내 토픽 정보들도 확인 할 수 있다.  </p><ul><li>토픽의 파티션 수</li><li>ISR 구성 정보</li><li>리더 정보</li><li>ETC.</li></ul></li><li><p><code>/root/consumers</code><br>
<!-- -->컨슈머 관련된 정보들이 저장되며, 컨슈머가 각각의 파티션들에 대한 오프셋 정보가 이곳에 저장된다. 지워지면 안되는 정보기 때문에 주키퍼의 영구 노드로 저장된다.
오프셋을 주키퍼에 저장할 수 있는 기능을 제공하고 있지만, 이후 릴리즈에서는 해당 기능이 Deprecate 될 것이다. 따라서 카프카의 topic에 오프셋을 저장하여 사용하는 것을 권장한다.</p></li><li><p><code>/root/config</code><br>
<!-- -->토픽의 상세 설정 정보를 확인할 수 있다. 토픽 생성시 기본값으로 생성한 작업 외에 상세 설정 추가를 통해 <code>retenstion.md</code>등을 별도로 설정한 경우 해당 옵션 정보를 확인할 수 있다.</p></li></ol>]]></content:encoded>
            <category>Kafka</category>
            <category>Study</category>
        </item>
        <item>
            <title><![CDATA[Spring boot TDD]]></title>
            <link>https://rhdtl78.github.io/dev-blog/spring/auto-monitor</link>
            <guid>https://rhdtl78.github.io/dev-blog/spring/auto-monitor</guid>
            <pubDate>Thu, 16 Jul 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Spring Boot + JPA + JUnit + Mockito]]></description>
            <content:encoded><![CDATA[<ol><li><p>개요</p><ul><li>Spring Boot 스터디를 위한 프로젝트로 AutoMonitor를 개발.</li><li>Mockito를 Springboot 환경에서 TDD방법론으로 접근해 사용해보는 것이 학습 목표.</li><li>궁극적으로, CI/CD Tool (e.g. jenkins) 를 활용하여 자동화 하는 것이 개발 목표.</li></ul><p>AutoMonitor란?</p><ul><li>Api Testing Application</li><li>주어진 API가 주어진 payload로 정상 작동하는가를 확인</li><li>API Health checking</li></ul><p>Stack</p><ul><li>Kotlin</li><li>Springboot</li><li>JPA</li><li>Junit</li><li>Mockito</li><li>Hibernate</li><li>JPA</li><li>Vue</li></ul><p>학습 전략</p><ul><li>TDD (Test Driven Development)</li><li>레이어 별로 Mock-up</li><li>항상 Test Case를 먼저 작성할 것</li></ul><p>환경 설정에 대한 설명은 생략.</p></li><li><p>Test Driven Development</p><p>TDD란? </p><blockquote><p>테스트 주도 개발(Test-driven development TDD)은 매우 짧은 개발 사이클을 반복하는 소프트웨어 개발 프로세스 중 하나이다.
개발자는 먼저 요구사항을 검증하는 자동화된 테스트 케이스를 작성한다. 그런 후에, 그 테스트 케이스를 통과하기 위한 최소한의 코드를 생성한다.
마지막으로 작성한 코드를 표준에 맞도록 리팩토링한다.
이 기법을 개발했거나 '재발견' 한 것으로 인정되는 Kent Beck은 2003년에 TDD가 단순한 설계를 장려하고 자신감을 불어넣어준다고 말하였다.
-- Wiki에서 발췌 <a href="https://ko.wikipedia.org/wiki/%ED%85%8C%EC%8A%A4%ED%8A%B8_%EC%A3%BC%EB%8F%84_%EA%B0%9C%EB%B0%9C" target="_blank" rel="noopener noreferrer">링크</a></p></blockquote><p>주목할 것은 '먼저 요구사항을 검증하는 자동화된 테스트 케이스를 작성한다.' 이다.
테스트 케이스 자체가 기능 명세가 되고, 프로그램의 청사진이 된다.</p><ol><li><p>JPA Repository Mocking</p><p>테스트의 목적은 작성한 Entity를 사용한 JpaRepository를 Mock-up 해보기 위함이다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Test Case */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RunWith(MockitoJUnitRunner::class) // Mockito runner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApiSpecJpaRepositoryTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Mock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lateinit var apiSpecJpaRepository: ApiSpecJpaRepository; // jpaRepository를 Mockito로 Mock-up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @InjectMocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lateinit var apiSpecRepository: ApiSpecRepository; // jpaRepository를 이용한 Respository. apiSpecJpaRepository를 의존 객체로 갖는다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @BeforeAll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun setUp() { // Mockito의 어노테이션을 실행.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MockitoAnnotations.initMocks(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* JPA Repository */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interface ApiSpecJpaRepository: JpaRepository&lt;ApiSpec, Long&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Repository */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApiSpecRepository(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val jpaApiSpecRepository: ApiSpecJpaRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>MockitoRunner가 의존성을 주입해주며 Mock-up을 만들어 준다. 위 테스트 클래스에서는 apiSpecJpaRepository가 Mock-up 객체가 되며 이를 apiSpecRepository가 사용한다.</p><p>등록된 API를 조회하는 기능을 구현하고자 한다. 이 때, Respository에 해당 기능을 바로 구현하지 않고, 인터페이스만 놓아둔다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Repository */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApiSpecRepository(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val jpaApiSpecRepository: ApiSpecJpaRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      * 등록된 api 목록 가져오기</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun getApis(page: Int): List&lt;ApiSpec&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return listOf();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>그리고 바로 테스트 케이스를 작성한다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Test Case */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApiSpecJpaRepositoryTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private fun mockResultList(size: Long): List&lt;ApiSpec&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return LongStream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .range(0, size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .mapToObj {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    val mocked = mock&lt;ApiSpec&gt;(); // Mock-up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Data mocking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    whenever(mocked.id).thenReturn(it + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    whenever(mocked.alias).thenReturn("Test Api - ${it + 1}");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    whenever(mocked.url).thenReturn("/api/v1/test/${it + 1}");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    whenever(mocked.payload).thenReturn("{ \"data\": { \"number\": ${it + 1} } }");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    mocked;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .toList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * 첫 페이지에 해당하는 API 목록을 불러온다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun getApis_페이지_번호로_조회하기() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // when</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val page: Int = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val recordSize: Int = 12;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val paging = PageRequest.of(page, recordSize);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // mocking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val mockedResults = mockResultList(12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val mockedPage = PageImpl&lt;ApiSpec&gt;(mockedResults)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        whenever(apiSpecJpaRepository.findAll(paging))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .thenReturn(mockedPage);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assertEquals(12, apiSpecRepository.getApis(page).size);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>여기서 주목할 것은 mockResultList와 테스트 케이스의 mocking방법이다.</p><p>mockResultList는 integer를 인자로 받아 그 값을 크기로 갖는 ApiSpec의 Mock-up 객체의 List를 반환한다.</p><p>데이터들은 실제 값을 직접 바인드 하지 않고, Mockito의 whenever로 Mock-up 데이터를 생성한다.</p><p>테스트 케이스에서는 apiSpecJpaRepository.findAll 의 결과를 mock-up 한다.</p><p>apiSpecJpaRepository의 findAll 함수에 PageRequest 인자를 넘겨주어 실행하면 12개의 원소를 가진 List객체가 반환된다는 의미이다.</p><p>물론 데이터는 모두 Mock-up된 상태이다.</p><p>테스트를 수행하면 당연히 통과하지 못한다. apiSpecRepository에서 테스트하려는 getApis가 의미없는 반환을 하고있기 때문이다.</p><p>이제 이 테스트 케이스를 통과하기 위해 ApiSpecRepository의 getApis함수를 마저 구현한다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApiSpecRepository(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val jpaApiSpecRepository: ApiSpecJpaRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val recordSize: Int = 12;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 등록된 api 목록 가져오기</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun getApis(page: Int): List&lt;ApiSpec&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val paging = PageRequest.of(page, recordSize);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val result: Page&lt;ApiSpec&gt;? = jpaApiSpecRepository.findAll(paging);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (result != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return result.content;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return listOf();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>PageRequest를 이용해 쿼리 결과를 제한하며, 반환할 내용은 모두 List로 변환한다.</p><p>이제 테스트를 다시 수행하면 통과할 것이다. 테스트가 통과할 수 있는 이유는 바로 apiSpecJpaRepository가 Mock-up 되었기 때문이다.</p><p>Mockito Test Runner가 @Mock으로 지정된 필드를 Mock-up해두고, Mock-up된 apiSpecJpaRepository를 @InjectMocks로 지정된 apiSpecRepository에 의존성 주입을 실행한다. 따라서 apiSpecRepository 내부에는 Mock-up된 jpaRepository가 위치하게 되며 내부에서 apiSpecJpaRepository를 통해 메서드를 호출할 수 있게 되었다.</p><p>또한, 내부의 함수를 whenever로 Mock-up했기 때문에 실제 Database에 쿼리를 질의하지 않고 기능이 동작 할 수 있었다.</p><p>이런 방법으로 테스트 케이스를 먼저 작성하고, 테스트를 수행하고, 실패한 테스트에 대해 리팩터링을 진행하는 것이 TDD의 기본이다.</p></li><li><p>Repository Test</p><p>Repository Test에서는 데이터의 저장, 조회가 내가 의도한 대로 이뤄지는지를 확인해야 하기 때문에 별도의 Mock-up을 만들지 않는다.
간단하게 Save-Load Test를 수행한다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RunWith(SpringRunner::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApiSpecRepositoryTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lateinit var apiSpecRepository: ApiSpecRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @BeforeAll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun setUp() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (i: Int in 1..60) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            val data = ApiForm(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    url = "http://localhost/api/v1/test/$i",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    alias = "TestApi - $i",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    payload = "{ data: [] }"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            apiSpecRepository.saveApi(data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @AfterAll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun cleanUp() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        apiSpecRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .jpaApiSpecRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .deleteAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>우선 setup과 cleanUp을 구성한다. 테스트 시작 전에 데이터를 미리 구성해 두고, 이후엔 테스트에 사용한 모든 데이터를 모두 제거한다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RunWith(SpringRunner::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApiSpecRepositoryTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun `saveApi - 새로운 API 등록`() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // mocking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val inputData = ApiForm(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                url = "http://test/api/v1/mocked",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                alias = "test",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                payload = "{ \"data\" : \"test\" }"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val inserted = apiSpecRepository.saveApi(inputData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val result = apiSpecRepository.jpaApiSpecRepository.findById(inserted.id!!).get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assertions.assertEquals(inputData.url, result.url);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assertions.assertEquals(inputData.alias, result.alias);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assertions.assertEquals(inputData.payload, result.payload);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Save 테스트에서는 데이터를 넣어보고, 이를 다시 꺼내어 확인하는 방식으로 테스트를 진행했다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RunWith(SpringRunner::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class ApiSpecRepositoryTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun `getApi - 단건 조회`() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // when</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val id : Long = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val result = apiSpecRepository.getApi(id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assertions.assertNotNull(result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assertions.assertEquals(result!!.id!!, id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Load Test에선 기존 준비한 데이터를 꺼내보는 방향으로 진행했다.</p></li><li><p>Controller Test
Controller Test는 앞서서 만든 Repository를 Mock-Up해서 진행한다. Controller Test의 목적은 매핑된 함수들이 제대로 동작 하는지를 보기 위함이지 데이터를 꺼내오는 것이 제대로 동작하는 것을 보는 것이 아니기 때문이다. 관심사를 생각해서 테스트 케이스와 Mock-Up 범위를 결정한다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RunWith(MockitoJUnitRunner::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AutoConfigureMockMvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DashboardControllerTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Mock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lateinit var apiSpecRepository: ApiSpecRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @InjectMocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lateinit var dashboardController: DashboardController;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Before</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun setUp() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MockitoAnnotations.initMocks(this);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private fun mockResultList(size: Long): List&lt;ApiSpec&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return LongStream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .range(0, size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .mapToObj {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ApiSpec(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            id = it + 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            alias = "Test Api - ${it + 1}",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            url = "/api/v1/test/${it + 1}",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            payload = "{ \"data\": { \"number\": ${it + 1} } }"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .toList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>우선 테스트 준비를 위와 같이 해둔다. 실제 Request를 주고 받는 테스트를 할 것이기 때문에 MockMVC를 사용한다. 앞서서 언급한 대로 apiSpecRepository는 Mock-UP해 두고 테스트 케이스 마다 예상 값을 정한다. 테스트 데이터는 엔티티를 사용하였다. JpaRepository테스트와 다른 점은 데이터 자체를 다시 Mockito로 Mock-Up하지 않은 것이다. Object De/Serialize에서 Mock-up객체의 다른 메서드, 프로퍼티들이 함께 결과에 포함 될 수 있기 때문에 데이터를 직접 구성하게 했다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RunWith(MockitoJUnitRunner::class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AutoConfigureMockMvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DashboardControllerTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun `getRegisteredApis - API Calling 테스트 - 데이터 조회`() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val mockedList = mockResultList(12)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        whenever(apiSpecRepository.getApis(1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .thenReturn(mockedList);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val request = get("/api/v1/apis/1")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .accept(MediaType.APPLICATION_JSON);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MockMvcBuilders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .standaloneSetup(dashboardController)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .perform(request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .andExpect(status().isOk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .andDo(ResultHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    println(it.response.contentAsString);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .andExpect(jsonPath("$").isArray)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .andExpect(jsonPath("$.*", Matchers.hasSize&lt;ApiSpec&gt;(12)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>조회 테스트이다. Mock-Up 데이터를 12개 (1 page 분량)을 준비해두고 페이지 번호를 주어 요청하는 테스트 시나리오이다.
이제 테스트를 수행하면 실패할 것이다. 컨트롤러에 가서 해당 기능을 구현한다.</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@RestController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DashboardController(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val apiSpecRepository: ApiSpecRepository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping("/api/v1/apis/{page}")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fun getRegisteredApis(@PathVariable("page") page: Int): List&lt;ApiSpec&gt; = apiSpecRepository.getApis(page)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Get요청 테스트를 작성했으니 GetMapping을 구성한다. Restful 디자인을 사용했다.
다시 테스트를 수행하면 통과한다.</p></li><li><p>반복...</p><p>이제 기능을 개발할 때 마다 위 흐름을 반복하면된다. </p><ol><li>Test Case 작성<ul><li>JpaRepository<ul><li>어떤 메서드를 사용해 데이터를 가져올 지 정한다.</li><li>Repository에 해당 메서드를 사용하는 기능의 껍데기를 만든다.</li><li>Repository에 JpaRepository의 Mock-Up을 의존성으로 주입한다.</li></ul></li><li>Repository<ul><li>mock-up없이, 실제 데이터의 CRUD가 이뤄지는지를 확인하는 테스트 케이스를 작성한다.</li></ul></li><li>Controller<ul><li>Repository로 꺼내온 데이터를 어떻게 핸들링 할 지에 대해 테스트 케이스를 작성한다.</li><li>실제 Request와 유사하게 테스트해야 하므로 MockMVC를 사용하는 것을 권장한다.</li><li>Repository의 Mock-Up을 Controller의 의존성으로 주입한다.</li></ul></li></ul></li><li>Test 수행</li><li>Refactoring</li></ol></li></ol></li><li><p>앞으로...</p><ol><li>Frontend와 Api연동.<ul><li>현재까지 작성된 Api들을 Frontend와 연동해 기능의 동작을 확인한다.</li></ul></li><li>CI/CD툴과 연동.<ul><li>Jenkins로 배치 프로세스를 구성해 테스트를 주기적으로, 자동화 한다.</li></ul></li></ol></li></ol>]]></content:encoded>
            <category>Spring</category>
            <category>Springboot</category>
            <category>TDD</category>
            <category>Mockito</category>
        </item>
        <item>
            <title><![CDATA[외부 설정]]></title>
            <link>https://rhdtl78.github.io/dev-blog/spring/external_configuration</link>
            <guid>https://rhdtl78.github.io/dev-blog/spring/external_configuration</guid>
            <pubDate>Mon, 20 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[Spring 외부 설정 학습]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://spring.io/images/spring-logo-9146a4d3298760c2e7e49595184e1975.svg" alt="spring logo" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="외부-설정">외부 설정<a href="#외부-설정" class="hash-link" aria-label="Direct link to 외부 설정" title="Direct link to 외부 설정">​</a></h3><p>외부 설정을 정의할 수 있는 위치는 기본적으로 다음과 같다.</p><ul><li>src/main/resources/application.properties</li><li>src/main/resources/application.yml</li><li>환경 변수</li><li>command line arguments</li></ul><p>아래 코드로 테스트 결과를 확인할 수 있다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.ApplicationArguments;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.ApplicationRunner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleRunner implements ApplicationRunner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value("${custom.name}")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run(ApplicationArguments args) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=================================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=================================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># src/main/resources/application.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">custom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>실행 결과</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-20 11:29:57.703  INFO 3188 --- [           main] com.example.Application                  : Started Application in 1.62 seconds (JVM running for 2.141)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="우선-순위">우선 순위<a href="#우선-순위" class="hash-link" aria-label="Direct link to 우선 순위" title="Direct link to 우선 순위">​</a></h3><p>우선 순위는 굉장히 많은 단계가 있다.</p><ol><li>유저 홈 디렉토리에 있는 spring-boot-dev-tools.properties</li><li>테스트에 있는 @TestPropertySource</li><li>@SpringBootTest 애노테이션의 properties 애트리뷰트</li><li>커맨드 라인 아규먼트</li><li>SPRING_APPLICATION_JSON (환경 변수 또는 시스템 프로티) 에 들어있는 프로퍼티</li><li>ServletConfig 파라미터</li><li>ServletContext 파라미터</li><li>java:comp/env JNDI 애트리뷰트</li><li>System.getProperties() 자바 시스템 프로퍼티</li><li>OS 환경 변수</li><li>RandomValuePropertySource</li><li>JAR 밖에 있는 특정 프로파일용 application properties</li><li>JAR 안에 있는 특정 프로파일용 application properties</li><li>JAR 밖에 있는 application properties</li><li>JAR 안에 있는 application properties</li><li>@PropertySource</li><li>기본 프로퍼티 (SpringApplication.setDefaultProperties)</li></ol><p>따라서 위의 예제는 15 순위 JAR 안에 있는 application properties를 사용한 것이다.</p><p>테스트 케이스용 외부 설정도 정의할 수 있다.
src/test/application.{yml, properties}에 정의하면 테스트 진행시 해당 파일을 resources에 정의된 application.{yml, properites} 무시하고 로드한다.</p><p>다음 테스트를 보면 그 차이를 확인 할 수 있다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.ApplicationArguments;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.ApplicationRunner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleRunner implements ApplicationRunner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value("${custom.name}")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value("${custom.age}")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run(ApplicationArguments args) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=================================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(age);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=================================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># src/main/resources/application.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">custom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">age</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">random.int</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 랜덤 값 지정</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>실행 결과</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-20 12:07:42.766  INFO 5853 --- [           main] com.example.Application                  : Started Application in 1.38 seconds (JVM running for 1.878)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1063398586</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>무사히 실행 된다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="테스트-설정">테스트 설정<a href="#테스트-설정" class="hash-link" aria-label="Direct link to 테스트 설정" title="Direct link to 테스트 설정">​</a></h3><p>테스트 케이스는 어떨까?
아래와 같이 테스트 케이스를 만들어 테스트를 진행한다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import static org.assertj.core.api.Assertions.assertThat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.junit.Test;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.junit.runner.RunWith;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.test.context.SpringBootTest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.env.Environment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.test.context.junit4.SpringRunner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RunWith(SpringRunner.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleRunnerTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment env;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void testRun() throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assertThat(env.getProperty("custom.name"))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .isEqualTo("test");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># src/test/resources/application.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">custom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이제 테스트를 진행하면 테스트가 실패함을 볼수 있다. 에러 로그를 보면 다음과 같이 age 속성을 확인 할 수 없다고 나온다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sampleRunner': Injection of autowired dependencies failed; nested exception is java.lang.IllegalArgumentException: Could not resolve placeholder 'custom.age' in value "${custom.age}"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이는 test의 설정에도 같은 속성을 정의하면 해결되지만, 이후에 어떤 속성이 추가될 지 모르기 때문에 별도의 파일로 관리 하는 것을 권장한다.
또한 @PropertySoruce는 yml 파일을 지원하지 않다 하니 .properties 로 변경할 것을 권장한다.</p><div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># src/main/resources/application.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom.name=app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom.age=${random.int} # 랜덤 값 지정</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># src/test/resources/test.properties</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom.name=test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.junit.Test;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.junit.runner.RunWith;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.test.context.SpringBootTest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.env.Environment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.test.context.TestPropertySource;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.test.context.junit4.SpringRunner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import static org.assertj.core.api.Assertions.assertThat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RunWith(SpringRunner.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@TestPropertySource(locations = "classpath:/test.properties")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleRunnerTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment env;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void testRun () throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assertThat(env.getProperty("custom.name"))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .isEqualTo("test");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>위 테스트 케이스를 실행하면 통과할 것이고, 이전의 SampleRunner를 통해 표시되는 내용도 달라진 것을 확인 할 수 있다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2020-04-20 14:11:55.186  INFO 11797 --- [           main] com.example.SampleRunnerTest             : Started SampleRunnerTest in 1.74 seconds (JVM running for 2.491)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-994668283</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=================================</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>src/main/resources/application.properties의 내용에 custom.name 을 app으로 변경했음에도 불구하고, 표시되는 내용은 src/test/resources/test.properties의 내용이 사용되었다.
이는 우선순위가 더 높은 설정(2순위의 @TestPropertySource)이 낮은 우선 순위의 설정(15순위의 JAR 안의 application.properties)를 덮어 쓰며 생긴 현상이다.
이전의 덮어쓰기와의 차이점은 설정 파일 자체를 교체한 것이 아닌, 파일 내용을 보며 키값을 비교해, 더 높은 우선 순위의 것을 사용한 점이다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="파일이-applicationproperties로-같은-경우에는-어떻게-될까">파일이 application.properties로 같은 경우에는 어떻게 될까?<a href="#파일이-applicationproperties로-같은-경우에는-어떻게-될까" class="hash-link" aria-label="Direct link to 파일이 application.properties로 같은 경우에는 어떻게 될까?" title="Direct link to 파일이 application.properties로 같은 경우에는 어떻게 될까?">​</a></h3><p>우선순위는 다음과 같다.</p><ol><li>file:./config/</li><li>file:./</li><li>classpath:./config/</li><li>classpath:./</li></ol><p><code>file:./</code>은 현재 프로젝트의 루트 디렉토리를 의미한다.</p><p>즉 <code>src/main/resources/application.properties</code>는 4순위의 우선순위를 갖는다. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="타입-세이프-프로퍼티-configurationproperties">타입 세이프 프로퍼티 @ConfigurationProperties<a href="#타입-세이프-프로퍼티-configurationproperties" class="hash-link" aria-label="Direct link to 타입 세이프 프로퍼티 @ConfigurationProperties" title="Direct link to 타입 세이프 프로퍼티 @ConfigurationProperties">​</a></h3><p>property 들을 Bean으로 등록 할 수 있다.</p><p>아래 의존성을 추가하면 내 프로젝트의 커스텀 설정의 메타데이터를 만들 수 있다.
예를 들면, IDE에서 properties 작성중 자동 완성의 정보를 만들 수 있다.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">spring-boot-configuration-processor</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">optional</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">optional</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties("custom")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CustomProperties {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getName() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setName(String name) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.name = name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getAge() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setAge(int age) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.age = age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이렇게 빈(Bean)으로 등록한 Property를 사용하기 위해 SampleRunner도 변경한다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.ApplicationArguments;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.ApplicationRunner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleRunner implements ApplicationRunner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CustomProperties custom;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run(ApplicationArguments args) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=================================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(custom.getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(custom.getAge());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=================================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이후 실행하면 정상적으로 설정 내용이 표시 될 것이다.</p><p>추가로, configuration processor를 추가한 결과도 다음과 같다.
<img loading="lazy" alt="type-safe-configuration" src="/assets/images/spring-type-safe-properties-b7d0c0cb610a8584fb76a82cf07ba3d1.png" width="929" height="134" class="img_ev3q">
내가 만든 커스텀 설정이 자동완성을 지원하게 되었다.</p><p>이 방식으로 설정을 적용할 경우 key의 case문제가 해결된다.
camelCase, kebap-case 등 모두 자동으로 적용된다.</p><p>또한 타입 컨버젼도 지원한다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.time.Duration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.time.temporal.ChronoUnit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.convert.DurationUnit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties("custom")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CustomProperties {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @DurationUnit(ChronoUnit.SECONDS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Duration duration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Duration getDuration() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.duration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setDuration(Duration duration) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.duration = duration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getName() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setName(String name) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.name = name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getAge() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this.age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setAge(int age) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.age = age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이렇게 @DurationUnit을 사용해 Duration 타입으로 자동으로 변경된다.
또 @DurationUnit을 사용하지 않고도, properties 정의 시에 값에 s, ns 등으로 시간을 알수 있는 접미사를 붙이면 자동으로 변경된다.</p><p>프로퍼티 값 검증도 지원한다.</p><p>@Validated, 또는 JSR-303(@NotNull, ...)을 모두 지원한다.</p>]]></content:encoded>
            <category>Spring</category>
            <category>Springboot</category>
        </item>
        <item>
            <title><![CDATA[SpringApplication (1)]]></title>
            <link>https://rhdtl78.github.io/dev-blog/spring/spring-boot-application/1</link>
            <guid>https://rhdtl78.github.io/dev-blog/spring/spring-boot-application/1</guid>
            <pubDate>Fri, 17 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[SpringApplication 학습]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://spring.io/images/spring-logo-9146a4d3298760c2e7e49595184e1975.svg" alt="spring logo" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="기본적인-spring-application-실행-방법">기본적인 Spring Application 실행 방법<a href="#기본적인-spring-application-실행-방법" class="hash-link" aria-label="Direct link to 기본적인 Spring Application 실행 방법" title="Direct link to 기본적인 Spring Application 실행 방법">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication.run(Application.class, args); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>위 코드는 SpringApplication 인스턴스를 직접 만들지 않고, 자동으로 설정등을 Spring 프레임워크에게 맞기고 내 application을 실행한다.
간단하고 좋은 방법이지만, Spring이 제공하는 Customize 기능들을 포기하게 된다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication app = new SpringApplication(Application.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.run(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>이렇게 인스턴스를 직접 만들어 App을 실행 할 수도 있다.</p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="로그-레벨-조정">로그 레벨 조정<a href="#로그-레벨-조정" class="hash-link" aria-label="Direct link to 로그 레벨 조정" title="Direct link to 로그 레벨 조정">​</a></h3><p>실행된 Application의 로그 레벨은 기본적으로 INFO 레벨이며 실행 인자에 디버그 모드를 명시하면 디버그 모드로 동작하게 된다.
디버그 모드로 동작 할 경우 로그 내용은 더 자세하게 표시되며 로드된 자동 설정 내역과 실패한 설정 로드 이력을 표시한다.</p><p>IDE의 실행 시 인자를 편집해 -Ddebug 옵션을 추가하거나 (JVM Options)
빌드된 결과물을 직접 Debug모드로 실행할 수 있다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -jar /path/to/jar -Ddebug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="배너-변경">배너 변경<a href="#배너-변경" class="hash-link" aria-label="Direct link to 배너 변경" title="Direct link to 배너 변경">​</a></h3><p>배너란?</p><ul><li>Application 실행시 표시되는 로고, 버전 등.
<img loading="lazy" alt="spring banner 예시" src="/assets/images/spring-banner-example-02e8e7602954d038ea70a3a6dc90ff92.png" width="1065" height="202" class="img_ev3q"></li></ul><p>Application의 실행시 표시되는 배너를 변경하기 위해서는 src/main/resources/banner.txt를 생성해 그 안에 원하는 배너를 텍스트로 구성하면 된다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// src/main/resources/banner.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===========</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test banner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===========</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="spring banner 변경 예시" src="/assets/images/spring-banner-change-example-565c47a6490003c44891ad6bb9624343.png" width="1052" height="75" class="img_ev3q"></p><p>배너에 지원되는 변수가 있어 Application의 정보등을 배너에 표시할 수 있다.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// src/main/resources/banner.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=========== </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test banner ${spring-boot.version}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">===========</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="spring banner에서 지원되는 변수" src="/assets/images/spring-banner-variable-d855d464b88878e5d9d3c6f95dc57701.png" width="1059" height="77" class="img_ev3q"></p><p>지원되는 변수 목록은 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-banner" target="_blank" rel="noopener noreferrer">링크</a>를 확인 </p><p>이미지도 지원한다. 파일이름을 banner로 저장 할 경우 자동으로 로드해 준다.</p><p>src/main/resources 이외의 위치에서 banner를 만들고 싶을 경우 application.properties, application.yml에서 설정할 수 있다.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">banner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">classpath/banner.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Application에서 banner를 조작할 수 있다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import ort.springframework.boot.Banner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication app = new SpringApplication(Application.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.setBannerMode(Banner.Mode.Off); // 배너를 표시하지 않는다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.run(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.PrintStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.Banner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.env.Environment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication app = new SpringApplication(Application.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 배너를 직접 생성</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.setBanner(new Banner(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public void printBanner(Environment environment, Class&lt;?&gt; sourceClass, PrintStream out) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                out.println("==================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                out.println("test banner");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                out.println("==================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.run(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="builder-pattern-사용-springapplicationbuilder">Builder Pattern 사용 (SpringApplicationBuilder)<a href="#builder-pattern-사용-springapplicationbuilder" class="hash-link" aria-label="Direct link to Builder Pattern 사용 (SpringApplicationBuilder)" title="Direct link to Builder Pattern 사용 (SpringApplicationBuilder)">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.builder.SpringApplicationBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new SpringApplicationBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .sources(Application.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .run(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>동일하게 banner 변경이 가능하다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.PrintStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.Banner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.builder.SpringApplicationBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.env.Environment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new SpringApplicationBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .sources(Application.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .banner(new Banner(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                public void printBanner(Environment environment, Class&lt;?&gt; sourceClass, PrintStream out) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    out.println("==================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    out.println("test banner");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    out.println("==================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .run(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content:encoded>
            <category>Spring</category>
            <category>Springboot</category>
        </item>
        <item>
            <title><![CDATA[SpringApplication (2)]]></title>
            <link>https://rhdtl78.github.io/dev-blog/spring/spring-boot-application/2</link>
            <guid>https://rhdtl78.github.io/dev-blog/spring/spring-boot-application/2</guid>
            <pubDate>Fri, 17 Apr 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[SpringApplication 학습]]></description>
            <content:encoded><![CDATA[<p><img loading="lazy" src="https://spring.io/images/spring-logo-9146a4d3298760c2e7e49595184e1975.svg" alt="spring logo" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-event">Application Event<a href="#application-event" class="hash-link" aria-label="Direct link to Application Event" title="Direct link to Application Event">​</a></h3><p>Application Event Listener 생성</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.context.event.ApplicationStartingEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.ApplicationListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Application이 시작 될 때의 이벤트 리스너</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleListener implements ApplicationListener&lt;ApplicationStartingEvent&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onApplicationEvent(ApplicationStartingEvent arg0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=======================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("Starting Application...");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=======================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>그런데 위의 ApplicationStartingEvent는 @Component 어노테이션으로 Bean등록을 했음에도 ApplicationContext 생성 이전의, 완전 시작점의 이벤트라서 정상 작동하지 않는다.
따라서 Application에 따로 등록해야 한다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication app = new SpringApplication(Application.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.addListeners(new SampleListener());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.run(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.context.event.ApplicationStartingEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.ApplicationListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Application이 시작 될 때의 이벤트 리스너</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleListener implements ApplicationListener&lt;ApplicationStartingEvent&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onApplicationEvent(ApplicationStartingEvent arg0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=======================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("Starting Application...");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=======================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>실행 결과
<img loading="lazy" alt="Spring Application Event 실습" src="/assets/images/spring-application-event-99295e61c5fb31434fab0f9e6d1af524.png" width="1059" height="261" class="img_ev3q"></p><p>Bean으로 등록한 이벤트의 경우</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication app = new SpringApplication(Application.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.run(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.context.event.ApplicationStartedEvent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.ApplicationListener;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Application이 시작 될 때의 이벤트 리스너</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleListener implements ApplicationListener&lt;ApplicationStartedEvent&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onApplicationEvent(final ApplicationStartedEvent arg0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=======================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("Application Started....");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("=======================");</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>실행 결과
<img loading="lazy" alt="spirng application event bean" src="/assets/images/spring-application-event-bean-6db89f53f47e82cbe2dfa61b269f354d.png" width="1442" height="80" class="img_ev3q"></p><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="web-application-type">Web Application Type<a href="#web-application-type" class="hash-link" aria-label="Direct link to Web Application Type" title="Direct link to Web Application Type">​</a></h3><p>기본적으로 servlet으로 동작하며 이후 사용 의존성에 따라 설정이 필요하다. 의존성에 Spring MVC가 없고, WebFlux로 구성할 경우, REACTIVE로 변경해야 하며 WebApp이 아닌 경우에는
NONE으로 설정해야 한다.</p><p>Application 실행부에서 이를 조작할 수 있다.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.SpringApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.WebApplicationType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@SpringBootApplication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Application {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SpringApplication app = new SpringApplication(Application.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.setWebApplicationType(WebApplicationType.SERVLET);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.setWebApplicationType(WebApplicationType.REACTIVE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.setWebApplicationType(WebApplicationType.NONE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app.run(args);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-arguments">Application Arguments<a href="#application-arguments" class="hash-link" aria-label="Direct link to Application Arguments" title="Direct link to Application Arguments">​</a></h3><p>기본적으로 ApplicationArguments를 Bean으로 등록해준다. jar로 패키지된 Application을 실행할때 인자를 주기 위해서는 -- 를 사용하면 된다. -D옵션은 JVM 옵션임을 유의해야한다.</p><p>ApplicationRunner 혹은 CommandLineRunner를 통해 인자를 활용할 수 있다.</p><p>ApplicationRunner</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.ApplicationArguments;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.ApplicationRunner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleRunner implements ApplicationRunner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run(ApplicationArguments args) throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("is foo delivered : " + args.containsOption("foo"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println("foo : " + args.getOptionValues("foo"));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -jar /path/to/jar.jar --foo=bar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>실행 결과
<img loading="lazy" alt="spring arguments ApplicationRunner 실행 결과" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAO0AAAAhCAYAAAA1ZyxAAAAK3WlDQ1BJQ0MgUHJvZmlsZQAASImVlwdQk9kWx+/3pTdaQqQTepPeAkgJPYCAdBCVkAQSSgwJQcWGyuIKrgUVEVQWdFFEwbUAshZEFNuiWADrgoiKsi4WsKCyH/AIu/vmvTfvzNw5v/nn3HPPufPdmRMAKOEcsTgDVgIgU5QtiQjwZsTFJzBwTwEaKAMyMAbWHK5UzAoPDwGITfu/22gXgCb8bcuJXP/++381FR5fygUASkQ4mSflZiLcgqy3XLEkGwDUCUQ3WJItnuAehGkSpECEhyY4dZLRE3loyVNMm4yJivBB2BQAPJnDkaQCQHZAdEYONxXJQ45C2EbEE4oQzkfYgyvg8BBuQ3h2ZubiCR5G2BSJFwNAUUOYmfyXnKl/y58sz8/hpMp5qq9Jw/sKpeIMzrL/82r+t2VmyKbPMEYWWSAJjEC8BnJ/PemLg+UsSg4Nm2YhbzJ+kgWywOhp5kp9EqaZx/ENlu/NCA2Z5hShP1ueJ5sdNc18qV/kNEsWR8jPSpH4sKaZI5k5V5YeLdcFfLY8f64gKnaac4QxodMsTY8MnonxkesSWYS8fr4owHvmXH9575nSv/QrZMv3ZguiAuW9c2bq54tYMzmlcfLaeHxfv5mYaHm8ONtbfpY4I1wez88IkOvSnEj53mzk45zZGy6/wzROUPg0g2gQAqJABAgDoYAB7IEDcAYuiIp8ddn8pdkTDfksFi+TCFMF2QwW8ur4DLaIazWbYWdjZwPAxBue+ize9Uy+TYiOn9HKDQHwz0XEpzOaczEAh28AQK+b0QwRT24EoLmcK5PkTGmTbw0DiEAR0IA60AEGwBRYAjvgBNyAF/ADQUjNUSAeLARcIACZQAKWgBVgDSgARWAL2AHKQAXYBw6CI+AYaASnwXlwCVwDN8Fd8AD0ggHwCgyDUTAGQRAOokBUSB3ShYwgC8gOYkIekB8UAkVA8VASlAqJIBm0AloHFUHFUBlUCdVAP0OnoPPQFagTugf1QYPQW+gzjILJMA3Who1ha5gJs+BgOApeAKfCWXAunA9vgkvhKvgw3ACfh6/Bd+Fe+BU8ggIoEoqO0kNZopgoH1QYKgGVgpKgVqEKUSWoKlQdqhnVjrqN6kUNoT6hsWgqmoG2RLuhA9HRaC46C70KvRFdhj6IbkC3oW+j+9DD6G8YCkYLY4FxxbAxcZhUzBJMAaYEU405ibmIuYsZwIxisVg61gTrjA3ExmPTsMuxG7F7sPXYFmwnth87gsPh1HEWOHdcGI6Dy8YV4HbhDuPO4W7hBnAf8SS8Lt4O749PwIvwa/El+EP4s/hb+Of4MYISwYjgSggj8AjLCJsJ+wnNhBuEAcIYUZloQnQnRhHTiGuIpcQ64kXiQ+I7EomkT3IhzSMJSXmkUtJR0mVSH+kTWYVsTvYhJ5Jl5E3kA+QW8j3yOwqFYkzxoiRQsimbKDWUC5THlI8KVAUrBbYCT2G1QrlCg8IthdeKBEUjRZbiQsVcxRLF44o3FIeUCErGSj5KHKVVSuVKp5S6lUaUqcq2ymHKmcoblQ8pX1F+oYJTMVbxU+Gp5KvsU7mg0k9FUQ2oPlQudR11P/UidYCGpZnQ2LQ0WhHtCK2DNqyqouqgGqO6VLVc9YxqLx1FN6az6Rn0zfRj9C7651nas1iz+LM2zKqbdWvWBzVNNS81vlqhWr3aXbXP6gx1P/V09a3qjeqPNNAa5hrzNJZo7NW4qDGkSdN00+RqFmoe07yvBWuZa0VoLdfap3Vda0RbRztAW6y9S/uC9pAOXcdLJ01nu85ZnUFdqq6HrlB3u+453ZcMVQaLkcEoZbQxhvW09AL1ZHqVeh16Y/om+tH6a/Xr9R8ZEA2YBikG2w1aDYYNdQ3nGq4wrDW8b0QwYhoJjHYatRt9MDYxjjVeb9xo/MJEzYRtkmtSa/LQlGLqaZplWmV6xwxrxjRLN9tjdtMcNnc0F5iXm9+wgC2cLIQWeyw6Z2Nmu8wWza6a3W1JtmRZ5ljWWvZZ0a1CrNZaNVq9tja0TrDeat1u/c3G0SbDZr/NA1sV2yDbtbbNtm/tzO24duV2d+wp9v72q+2b7N84WDjwHfY69DhSHec6rndsdfzq5OwkcapzGnQ2dE5y3u3czaQxw5kbmZddMC7eLqtdTrt8cnVyzXY95vqHm6VbutshtxdzTObw5+yf0++u785xr3Tv9WB4JHn86NHrqefJ8azyfOJl4MXzqvZ6zjJjpbEOs15723hLvE96f/Bx9Vnp0+KL8g3wLfTt8FPxi/Yr83vsr++f6l/rPxzgGLA8oCUQExgcuDWwm63N5rJr2MNBzkErg9qCycGRwWXBT0LMQyQhzXPhuUFzt819GGoUKgptDANh7LBtYY/CTcKzwn+Zh50XPq983rMI24gVEe2R1MhFkYciR6O8ozZHPYg2jZZFt8YoxiTG1MR8iPWNLY7tjbOOWxl3LV4jXhjflIBLiEmoThiZ7zd/x/yBRMfEgsSuBSYLli64slBjYcbCM4sUF3EWHU/CJMUmHUr6wgnjVHFGktnJu5OHuT7cndxXPC/edt4g351fzH+e4p5SnPIi1T11W+qgwFNQIhgS+gjLhG/SAtMq0j6kh6UfSB/PiM2oz8RnJmWeEqmI0kVti3UWL13cKbYQF4h7s1yzdmQNS4Il1VJIukDalE1DhqXrMlPZd7K+HI+c8pyPS2KWHF+qvFS09Poy82Ublj3P9c/9aTl6OXd56wq9FWtW9K1kraxcBa1KXtW62mB1/uqBvIC8g2uIa9LX/LrWZm3x2vfrYtc152vn5+X3fxfwXW2BQoGkoHu92/qK79HfC7/v2GC/YdeGb4W8wqtFNkUlRV82cjde/cH2h9IfxjelbOrY7LR57xbsFtGWrq2eWw8WKxfnFvdvm7utYTtje+H29zsW7bhS4lBSsZO4U7aztzSktGmX4a4tu76UCcrulnuX1+/W2r1h94c9vD239nrtravQriiq+Pyj8MeeyoDKhirjqpJ92H05+57tj9nf/hPzp5pqjeqi6q8HRAd6D0YcbKtxrqk5pHVocy1cK6sdPJx4+OYR3yNNdZZ1lfX0+qKj4Kjs6Mufk37uOhZ8rPU483jdCaMTu09STxY2QA3LGoYbBY29TfFNnaeCTrU2uzWf/MXqlwOn9U6Xn1E9s/ks8Wz+2fFzuedGWsQtQ+dTz/e3Lmp9cCHuwp22eW0dF4MvXr7kf+lCO6v93GX3y6evuF45dZV5tfGa07WG647XT/7q+OvJDqeOhhvON5puutxs7pzTefaW563zt31vX7rDvnPtbujdzq7orp7uxO7eHl7Pi3sZ997cz7k/9iDvIeZh4SOlRyWPtR5X/Wb2W32vU++ZPt++608inzzo5/a/eip9+mUg/xnlWclz3ec1L+xenB70H7z5cv7LgVfiV2NDBb8r/777tenrE394/XF9OG544I3kzfjbje/U3x147/C+dSR85PFo5ujYh8KP6h8PfmJ+av8c+/n52JIvuC+lX82+Nn8L/vZwPHN8XMyRcCZHARSy4JQUAN4eQGbkeACoNwEgzp+asScNmvpfMEngP/HUHD5pTgAcyQNgYny0bwHgaN7UWEtBVrgXAFFeALa3l69/mTTF3m4qFwmZVTAl4+PvkBkSZwbA1+7x8bHG8fGv1Uix9wFoGZ2a7SfMqAMAh0nqahr9CP5hU3P/X3r8pwcTFUzu/5v/E8Z1GvGGi0YHAAAAVmVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAADkoYABwAAABIAAABEoAIABAAAAAEAAADtoAMABAAAAAEAAAAhAAAAAEFTQ0lJAAAAU2NyZWVuc2hvdAR7JqUAAAHVaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjIzNzwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOlVzZXJDb21tZW50PlNjcmVlbnNob3Q8L2V4aWY6VXNlckNvbW1lbnQ+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4zMzwvZXhpZjpQaXhlbFlEaW1lbnNpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgqOpjJKAAALN0lEQVR4Ae2cd8gUOxDAY++C2HtDsSv2rigoNhAVLH9YEQuKir0j9ob4h713sSt2FAvYe8Heu2LB3vW9X3hZ99bdze53d37n93bgbrPJzCQzu9lMJpkkypMnz0/hAVavXi0eP34s+vTp4wHbH0ratGnFpEmTRLZs2STh5cuXxdChQ/0xiQB2unTpxJIlS8SePXvEzJkztRw7d+4sGjRoYOANHjxYXL161bg3J6KpP3M94aT9yh9OXYo2WbJkol69euL8+fPi/v37Kju4umggsUtZSBEd9vbt2yF5kbpp1KiR7LBr1qwRAwcOFNOnT48Ua198EiVK5At//vz5ok2bNmL9+vVaumjqT1u5RwS/8ntk64rGB7tTp06iYcOGrnhB4S8NJP2VtE8lTpxY8DD79esnfv60H5STJ08uypYtK169eiWuXbvmiGetIWXKlCJp0qSiQoUK4tu3b2Lr1q0S5fPnzyGoOXPmFPwuXbok3r17F1LGja78NwJTBrIVK1ZMfPjwQbx48cJU8iuZPn16UaRIEXHnzh3x7NkzowB9fPr0SXz9+tXIsyac9McIkyJFCvH+/fsQfaFLdEJ7FDjVTzn4/NBLqlSpROnSpcWNGzfE8+fPFblwo/civ8HIIUG9ALpwekespNSbJk0aQacF0IVKf/z4UXz//l3mu8lHGfDlyxd55Y88aBU9eW7yU/63gbbTrlq1SvCCAXfv3g0xj8lnVFRmLTgosFWrViS1MGPGDJEhQwYDb+nSpTKtzOMsWbKI8ePHh+AcP35cTJgwQeLpyg3GDomCBQuKsWPHygcNysuXL0MweYlGjx4t8ubNa+SjA6wB84tiFNoknPRXo0YN0aNHD7Fy5Uqxbt06g3Lq1Kkie/bsokWLFvIl1tU/bNgwUbx4cXHw4EFRq1Ytg0+zZs209Dr5DWYuiYwZM4p58+ZJjIULFxofXhcSWVSiRAkxatQoA6127dqCH7B27VqB3gA3+WbNmiWSJEki2rdvL3H5Yxpy7NgxMXHiRK38BtFfltCax8wtR4wYIUdCq2wdOnSQHXbbtm2iW7du8gVnbuIVhg8fLgYMGCCePHki+ZPmN23aNMmif//+ssOePn1a5jESVqxYUc6BQNCV69oxaNAg+UFiDstcljmdGZij0mH5UPCCHT16VN737NnTjOaadtLfvn37pMx16tQx6PlIYDVgrQBe62fU4iNw9uxZMWXKFHHo0CFP9Dr5JRMff3Qgr8Dcn2c9ZswYSYKO1fPfuHFjCBsn+UKQbG686s+GNKaztCMtphbw48eP3wTB7ABOnjwpnj59Kn9nzpz5Dc8p49GjR7IIcxj+qi6FX6BAAWn2qQeLecrIjvNn9+7dQleu+NhdaTujxMOHDw2nEyO3cixhZhUtWlS8efNGfvnhsWHDBlGqVClRrlw5O5a2eUomq/4wI69cuSIYcfhYvH37VjRp0kTy2LJlixz9/dSPPubOnSvpDx8+rKXXyW8rjE0mz46PLsC83StgqaAbZWkxtVK6suNhlc8Ox5wXqedn5hkraW2ndWsoX8TKlSuLkSNHyjnY9evXxezZs2XndaPzUpYpUyY5l753756BjneRuS8PWlduEDkk6PCA+UU5ceKE0WkLFy4sy3m5J0+eLNPqz+u8TeE7XTdt2iQ7bdOmTcWyZcukecjLzIhOZwa81r9jx46QanTt18kfwszlhrl09+7dXTAiU2SVT8dVJ7+OPpbLw+q0N2/eFG3bthWtW7eWZitOEOapeFS9zvmclKM6BqaRFRi1dOVWGuu9deSjHKeRAsX/wIEDgrmaGVSZOS8uacx+RqqaNWsKphiZM2eWVgu8VB1e6gfXulyio1ed1txus/zm/PhO28lHm5SMqn3KkWUu86I/Rf+3XH+9pXFsMV7OBQsWiC5duojNmzfLF79u3bpx5PaLjPkrDyV37txGJmk8q69fv5aeXrdyg8ghoZavChUqZGDgxVaA1QD8u44tTVfMV/WzerAxsYF8+fLJq58/phOY6cqZggkO+Knfrj4dvU5+O552eZj2PH9+WF1+QXnelZnsh56BwdxRzY44nfx+6ok1XNeRFhM0V65css18hXHtlylTRt7j9MAhw4i1f/9+2ZkqVaoky5QjJVxhMV3pVDiBcK60bNlSslRLQ7pyt/rpgCzf4Knt3bu3nJeZnUK8EBcvXpRmKt5qTFnywMHhgndSAXNINp1gYbCMxUcFnej0Bz1rvLzs1atXl8s/zHMBP/VLAsufF3o3+S3sHG+ZO6oOlzVrVkc8pwI+gEx5eK/wmD948EB+sJyW38x8+FiyctG3b1+5qcW8auFFfjOvvynt2mlRIrtVFOCowZMMsKTA2lrVqlWFGllR1M6dOwVmcySAXVJ0mJIlS8ofPOkge/fulex15bo2sNxD58M8BXCo8BIo05nlJjzcrNHi2QQY3VX9MuO/vMWLF8uXrl27dsaHTKc/6NEVHxBGLDyoZvBav5nGnNbR6+Q383JKW01UJzy3fJa96HB89AA22bB0o4NFixZJS6hatWqCn/rIKjqd/Arvb7sm8rqN0UkwRpb8+fNLRxRrmNEAzEeWQhiF+DBYQVduxbfes17JJgflBbWWM5qAgymHjMqks+JF6z7c+nX0OvmjJVek+PJu8OHD028HOvntaGI5L+xOG8vCBW0LNJAQNRC2IyohKiWQKdBALGsg6LSx/HSCtgUasNFA0GltlBJkBRqIZQ24eo+tDU+dOrVcU2RJw2nSb6WJhXscFeZdTXh4cSapJQq2YEYL8IwqYB+yWh9VecE10IBfDXjqtCxgx0KQul/hFD4ebn6sHxPep8K2xo0bJ7dKduzYUaFG/Lp9+3a51su2OpbIAgg0EK4GPHVac5D6qVOn5OaBcCuOD/pz584ZIV9/qv7ly5eL5s2bC7UX9k/VG9STcDXgOqdldGKUNQepE8lBRIYZMD8JmTNvKfNTbsa1S7MTi5/dPmQ7fL957PZiR06OHDl+I2VKwJ5qgvzRhxVYA1Ry00Z2N7ETKoBAA9HSgOtIG99B6gjNxom4BFl7VRid0hyozsZ74nTZxNGrV6+QwHJ4EobIThu1E8gtSNtrGwK8QAN+NOA60sZ3kLpVED9B1lZap3tGSiwHToy4deuWDFDAUQVwfMquXbtkMDrbN9lyWL58ecF0wQxxDdI28wjSgQa8asB1pI3PIHUlQFyDrBW9lyujJWcqHTlyRAa8V6lSRY7uc+bMkeSYv+xJJmiAzensRVZBC4q/3yBtRRdcAw341YBrp3VjpgtC15W78TaXRTvImqUfdQgagQLUx4FjAPN0IoCsc1k1hzW302+Qtpk2SAca8KOBOHdaNaezcw7x8uvK/TTyT+PSdkxxOixXzo/iNAlMaY67scoMvjUI/U+3Oajv/6MB1zmtmxqiHaSu6g43yFrxcbpyoqTaZEEHpT5GW4LfGWE5gobgfjZgEPMaQKCB+NZAnEdaGq4LQteVexGe0S2cIGsvdXBwHMd2KgcTx5GycwkPMss9LONwNnL9+vW9sAtwAg1EVQNxHmlpFbukGHEJUu/atavsXNYgdbdyL5IpM9sLrl8ceNMxGV1pP8fZ4CFesWKFZEVH5qNBAHzjxo3liQrQqCB5v/UF+IEGIqGBiMTT6oLQdeWREMSNB0He5r3HnJJgDabHI8zxK9YDy+HLUaYEv5tP/Xerz1ymznwib8iQITKQ31wepAMN+NVARDqt30r/ND7zVnW2FXWzQSKaI7hZPnZSqfXlCxcuyLVfc3mQDjTgVwP/i07rVykBfqCBWNZAWHPaWBYsaFuggYSqgaDTJtQnG8iVYDXwD0S46+0n/+jWAAAAAElFTkSuQmCC" width="237" height="33" class="img_ev3q"></p><p>CommandLineRunner</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Arrays;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.CommandLineRunner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.stereotype.Component;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SampleRunner implements CommandLineRunner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run(String... args) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Arrays.stream(args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .forEach(System.out::println);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -jar /path/to/jar.jar --foo=bar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>실행 결과
<img loading="lazy" alt="spring arguments CommandLineRunner 실행 결과" src="/assets/images/spring-application-arguments2-05f082835fedd7afb47ea0de36f7c1e0.png" width="1402" height="66" class="img_ev3q"></p><p>순서 지정도 가능하다. (@Order 어노테이션)</p>]]></content:encoded>
            <category>Spring</category>
            <category>Springboot</category>
        </item>
    </channel>
</rss>